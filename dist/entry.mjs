var Y=class{constructor(e){this.Instruments=e.Instruments,this.KeySignature=e.KeySignature,this.Measures=e.Measures,this.Pages=e.Pages}};var D=class{constructor(e,t,n,s){this.x=e,this.y=t,this.width=n,this.height=s}IsHovered(e,t,n){return e>=this.x+n.x&&e<=this.x+n.x+this.width&&t>=this.y+n.y&&t<=this.y+n.y+this.height}};var re=(o=>(o[o.None=0]="None",o[o.Selection=1]="Selection",o[o.Deletion=2]="Deletion",o[o.InputChange=3]="InputChange",o[o.AddNote=4]="AddNote",o))(re||{});function Te(){return{messageString:"",messageData:{MessageType:0,Message:{msg:"",obj:{}}}}}var mt=42;function v(i,e,t,n,s="black"){let{canvas:o,context:r,camera:a}=i;r.fillStyle=s,r.font=`${mt}px Bravura`,r.fillText(e,t+a.x,n+a.y)}var j=class{constructor(e,t,n,s){this.ID=e,this.Position=t,this.Bounds=new D(0,0,0,0),this.Type=n,this.SelType=2,this.Beat=s,this.Selected=!1,this.Editable=!0}render(e){let t;switch(this.Type){case"treble":t="\u{1D11E}";break;case"bass":t="\u{1D122}";break;default:t="\u{1D11E}"}let n=this.Selected?"#1065b0":"black";v(e,t,this.Position.x,this.Position.y,n)}SetBounds(e,t){let n=e.Divisions.find(f=>f.Beat===this.Beat&&f.Staff===t),s=this.Beat===1?e.Bounds.x:n.Bounds.x,o=3,r=2,a=0,u=t===0?p.GetMeasureMidLine(e):e.GetGrandMeasureMidLine();switch(this.Position.x=s+o,this.Bounds.x=s+o,this.Type){case"bass":r=-2}this.Position.y=n.Bounds.y+a+(u+r)*5,this.Bounds.y=n.Bounds.y,this.Bounds.width=30,this.Bounds.height=85}IsHovered(e,t,n){return this.Bounds.IsHovered(e,t,n)}};function I(i,e,t){let n=t===0?"treble":"bass";return t===0?(i.Clefs.sort((s,o)=>s.Beat-o.Beat),i.Clefs.forEach(s=>{if(s.Beat<=e){n=s.Type;return}})):(i.GrandClefs.sort((s,o)=>s.Beat-o.Beat),i.GrandClefs.forEach(s=>{if(s.Beat<=e){n=s.Type;return}})),n}var N=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],St=new Map([["treble",16],["bass",3]]);function Me(i){return Math.floor(440*Math.pow(2,(i-69)/12)*1e3)/1e3}function Si(i,e,t=0){let n=0,s=69,o=0,r=t===0?16:34,a=r;if(e===s)return r;if(e>s)for(let u=s;u<e;u++)console.log("starting"),console.log(N[n]),N[n]==="C"||N[n]==="F"?(a-=0,n===0?n=N.length-1:n-=1):(a-=1,n-=1);else if(s>e)for(let u=s;u>e;u--)console.log("starting"),console.log(N[n]),N[n]==="B"||N[n]==="E"?(a+=0,n===N.length-1?n=0:n+=1):(a+=1,n+=1);return console.log("midiNote: ",e),console.log("line: ",a),console.log("accidental"),a}function Ce(i,e,t=0,n=0){let s=0,o=St.get(i);n===1?o=34:o=16;let r=69,a=r;if(e===o)return r;if(e>o)for(let u=o;u<e;u++)N[s]==="C"||N[s]==="F"?(a-=1,s===0?s=N.length-1:s-=1):(a-=2,s-=2);else for(let u=o;u>e;u--)N[s]==="B"||N[s]==="E"?(a+=1,s===N.length-1?s=0:s+=1):(a+=2,s+=2);return a+=t,a}function Ne(){let i=new Map,e=new Map,t=0,n=0,s=45,o=0,r=11;for(let a=21;a<=127;a++)t>=N.length&&(t=0,n++),s=[0,2,3,5,7,8,10].includes(o)?s-1:s,i.set((N[t]+n).toString(),Me(a)),e.set(a,{NoteString:(N[t]+n).toString(),Frequency:Me(a),Line:s,Accidental:N[t].includes("#")?1:0}),t++,o>=r?o=0:o++;return e}var C=class{constructor(e){this.Beat=e.Beat,this.Duration=e.Duration,this.Line=e.Line,this.Rest=e.Rest,this.Tied=e.Tied,this.Accidental=0,this.Staff=e.Staff,this.Clef=e.Clef,this.Selected=!1,this.SelType=1,this.Bounds=new D(0,0,0,0),this.Bounds.width=12,this.Bounds.height=10,this.Editable=e.Editable!==void 0?e.Editable:!0,this.ID=-1,this.Tuple=e.Tuple,e.TupleDetails&&(this.TupleDetails=e.TupleDetails)}SetBounds(e){this.Bounds=e}SetID(e){this.ID=e}SetTiedStartEnd(e,t){this.TiedStart=e,this.TiedEnd=t}IsHovered(e,t,n){return this.Bounds.IsHovered(e,t,n)}GetMidiNumber(){let e=this.Staff===0?this.Line:this.Line-1e3;return Ce(this.Clef,e,this.Staff)}};var K=new Map([[1,1],[.5,.5],[.25,.25],[.125,.125],[.0625,.0625],[.03125,.03125]]);function Z(i){let e=i,t=[];for(i%.03125===0||console.error("Not divisible by standard value, not implemented"),K.has(i)&&(t.push(i),e-=i,e!==0&&console.error("HUH?"));e>0;){for(let[s,o]of K)K.get(s)<=e&&(t.push(K.get(s)),e-=K.get(s));e<.03125&&(e=0)}return t}var _=30;function ue(i,e,t,n){let s=[],o=0,r=0;if(e.sort((a,u)=>a.Beat-u.Beat),e.filter(a=>a.Staff===t).length===0){let a={Beat:1,Duration:1,Line:t===0?i.SALineMid:i.SBLineMid,Rest:!0,Tied:!1,Staff:t,Tuple:!1,Clef:t===0?"treble":"bass"};i.AddNote(new C(a))}return e.filter(a=>a.Staff===t).forEach(a=>{s.find(u=>u.Beat===a.Beat&&u.Staff===a.Staff)||(s.push({Beat:a.Beat,Duration:a.Duration,Bounds:fe(i,a.Beat,a.Duration,t,n),Staff:t}),a.Tuple?o=a.Beat+a.Duration/a.TupleDetails.Count*i.TimeSignature.bottom:o=a.Beat+a.Duration*i.TimeSignature.bottom,r+=a.Duration)}),r>0&&o-1<i.TimeSignature.bottom&&Re(i,s,t),Re(i,s,t),s}function fe(i,e,t,n,s){let o=i.GetMeasureHeight(),r=i.GetGrandMeasureHeight()-o,a=n===1?r:o,u=i.Bounds.width*t,f=n===0?i.Bounds.y:i.Bounds.y+o,l=i.Bounds.x+i.XOffset+(e-1)/i.TimeSignature.bottom*i.Bounds.width;return new D(l,f,u,a)}function le(i,e,t){let n=e.filter(l=>l.Staff===t),s=e.filter(l=>l.Staff===0),o=e.filter(l=>l.Staff===1),r=o.length>s.length?o.length:s.length,a=_*r,f=(i.Bounds.width-a)/r;n.sort((l,h)=>l.Beat-h.Beat),n.forEach((l,h)=>{if(l.Bounds.width=l.Duration*i.Bounds.width,h>0){let d=n[h-1].Bounds.x+n[h-1].Bounds.width;d!==l.Bounds.x&&(l.Bounds.x=d)}h===0&&n.length===1&&(l.Bounds.width=i.Bounds.width)})}function Re(i,e,t){let n=e.sort((d,m)=>d.Beat-m.Beat),s=1,o=[];n.filter(d=>d.Staff===t).forEach((d,m)=>{let c=i.Notes.filter(g=>g.Beat===d.Beat);if(d.Beat===s)s=d.Beat+d.Duration*i.TimeSignature.bottom,c[0].Tuple&&(s=c[0].TupleDetails.EndBeat);else if(d.Beat>=s){let g=(d.Beat-s)/i.TimeSignature.bottom,S=Z(g),B=s;S.sort(),S.forEach(b=>{o.push({Beat:B,Duration:b,Bounds:fe(i,B,b,d.Staff,i.Camera),Staff:d.Staff}),B+=b*i.TimeSignature.bottom}),s=d.Beat+d.Duration*i.TimeSignature.bottom}}),e.push(...o),o.forEach(d=>{i.Notes.find(S=>S.Beat===d.Beat)!==void 0&&console.error("Note found in division gap");let c=I(i,d.Beat,t),g={Beat:d.Beat,Duration:d.Duration,Line:d.Staff===0?i.SALineMid:i.SBLineMid,Rest:!0,Tied:!1,Staff:d.Staff,Tuple:!1,Clef:c};i.AddNote(new C(g))});let r=i.TimeSignature.top/i.TimeSignature.bottom*i.TimeSignature.bottom+1,a=e.filter(d=>d.Staff===t);a=e.sort((d,m)=>d.Beat-m.Beat);let u=a[a.length-1],f=u.Beat+u.Duration*i.TimeSignature.bottom,l=[],h=r-f;if(h>0){let d=h/i.TimeSignature.bottom,m=Z(d),c=f;m.sort(),m.forEach(g=>{l.push({Beat:c,Duration:g,Bounds:fe(i,c,g,u.Staff,i.Camera),Staff:t}),c+=g*i.TimeSignature.bottom})}e.push(...l),l.forEach(d=>{i.Notes.find(S=>S.Beat===d.Beat&&S.Staff===d.Staff)!==void 0&&console.error("Note found in division gap");let c=I(i,d.Beat,t),g={Beat:d.Beat,Duration:d.Duration,Line:d.Staff===0?i.SALineMid:i.SBLineMid,Rest:!0,Tied:!1,Staff:d.Staff,Tuple:!1,Clef:c};i.AddNote(new C(g))})}function q(i,e){let t={DivGroups:[]},n=[],s=[],o=!1;return i.Divisions.filter(a=>a.Staff===e).sort((a,u)=>a.Beat-u.Beat).forEach((a,u)=>{let f=i.Notes.filter(h=>h.Beat===a.Beat&&h.Staff===e);f.sort((h,d)=>h.Line-d.Line);let l=de(a.Beat,f,e);l&&o?(t.DivGroups.push({Divisions:n,Notes:s}),n=[],s=[],o=!1):l||(o?a.Duration>.125?(o=!1,t.DivGroups.push({Divisions:n,Notes:s}),n=[],s=[],n.push(a),s.push(f),t.DivGroups.push({Divisions:n,Notes:s}),n=[],s=[]):(a.Beat===3&&(t.DivGroups.push({Divisions:n,Notes:s}),n=[],s=[]),n.push(a),s.push(f),u===i.Divisions.filter(h=>h.Staff===e).length-1&&(t.DivGroups.push({Divisions:n,Notes:s}),n=[],s=[])):(n.push(a),s.push(f),a.Duration>.125?(t.DivGroups.push({Divisions:n,Notes:s}),n=[],s=[]):(o=!0,u===i.Divisions.filter(h=>h.Staff===e).length-1&&(t.DivGroups.push({Divisions:n,Notes:s}),n=[],s=[]))))}),t}function de(i,e,t){let n=e.filter(o=>o.Beat===i&&o.Staff===t),s=n.find(o=>o.Rest);return s&&n.length>1&&console.error("Rest found on beat with multiple notes, beat: ",i),s!==void 0}var ct=9;function ye(i,e,t,n,s){Ie(i,e,n,{num:t,bounds:new D(0,0,0,0)},s)}function ve(i,e,t,n,s,o){let r=!0,a=p.GetLineHovered(n,i),u=i.Divisions.find(f=>f.Bounds.IsHovered(t,n,s));u===void 0&&(r=!1),r&&Ie(i,e,u,a,o)}function Ie(i,e,t,n,s,o=1){let r=i.Notes.filter(h=>h.Beat===t.Beat);if(r.length<1){console.error("No notes found in division");return}let a=r[0].Tuple;a&&e!==t.Duration&&(e=e/r[0].TupleDetails.Count);let u=I(i,t.Beat,t.Staff),f={Beat:t.Beat,Duration:e,Line:n.num,Rest:s,Tied:!1,Staff:t.Staff,Tuple:a,TupleDetails:r[0].TupleDetails,Clef:u},l=new C(f);t.Duration===e?(i.ClearRestNotes(t.Beat,t.Staff),i.AddNote(l,!0)):gt(f.Beat,f.Duration,i)&&bt(i,f,t.Staff),i.CreateDivisions(i.Camera,!0),G(i,t.Staff)}function G(i,e){q(i,e).DivGroups.forEach(n=>{let{Divisions:s,Notes:o}=n,r=W(o,s,e,i);s.forEach(a=>{let u=i.Notes.filter(f=>f.Beat===a.Beat&&f.Staff===e);u.sort((f,l)=>f.Line-l.Line),u.forEach((f,l)=>{let d=he(u,l,r)?r===0?11:-11:0;if(!f.Rest){let m=f.Staff===0?0+i.SALineTop:i.SBLineTop;f.Bounds.x=Math.floor(a.Bounds.x+ct+d),f.Bounds.y=p.GetNotePositionOnLine(i,f.Line)}})})})}function gt(i,e,t,n=1){return i*e<=t.TimeSignature.top*(1/t.TimeSignature.bottom)}function Bt(i,e,t,n){let s=t.filter(r=>r.Beat===e&&r.Staff===n),o=s.find(r=>r.Rest);return o&&s.length>1?console.error("Rest found on beat with multiple notes, beat: ",e):o&&s.length===1&&i.ClearRestNotes(e,s[0].Staff),o!==void 0}function bt(i,e,t){let n=e.Duration,s=e.Beat;e.Rest&&(e.Line=t===0?i.SALineMid:i.SBLineMid);let o=!1,r=-1,a=-1;i.Divisions.filter(u=>u.Staff===t).forEach((u,f)=>{if(o&&e.Rest&&(o=!1),n>=u.Duration&&s===u.Beat){i.ClearRestNotes(s,e.Staff),n>u.Duration&&o===!1&&!e.Rest&&(o=!0,r=u.Beat,a=u.Beat+(n-u.Duration)*i.TimeSignature.bottom);let l={Beat:u.Beat,Duration:u.Duration,Line:e.Line,Rest:e.Rest,Tied:o,Staff:u.Staff,Tuple:!1,Clef:I(i,u.Beat,u.Staff)},h=new C(l);o&&(h.SetTiedStartEnd(r,a),n-u.Duration<=0&&(o=!1)),n-=u.Duration,s+=u.Duration*i.TimeSignature.bottom,i.AddNote(h,!0)}else if(n<u.Duration&&s===u.Beat&&n>0){let l=i.Notes.filter(S=>S.Beat===u.Beat&&S.Staff===u.Staff);if(Bt(i,s,l,u.Staff)){let S={Beat:u.Beat,Duration:n,Line:e.Line,Rest:e.Rest,Tied:o,Staff:u.Staff,Tuple:!1,Clef:I(i,u.Beat,u.Staff)},B=new C(S);o&&(B.SetTiedStartEnd(r,a),n-u.Duration<=0&&(o=!1)),n=0,i.AddNote(B,!0);return}let h={Beat:u.Beat,Duration:n,Line:e.Line,Rest:e.Rest,Tied:!1,Staff:u.Staff,Tuple:e.Tuple,TupleDetails:e.TupleDetails,Clef:I(i,u.Beat,u.Staff)},d=u.Duration-n,m=Z(d).sort((S,B)=>S-B),c=u.Beat,g=u.Beat+d*i.TimeSignature.bottom;l.forEach(S=>{S.Duration=n,S.Tied=!0,S.SetTiedStartEnd(c,g);let B=u.Beat+n*i.TimeSignature.bottom;m.forEach((b,T)=>{let L=T<m.length-1,M={Beat:B,Duration:b,Line:S.Line,Rest:!1,Tied:!0,Staff:S.Staff,Tuple:S.Tuple,TupleDetails:S.TupleDetails,Clef:I(i,u.Beat,u.Staff)},x=new C(M);x.SetTiedStartEnd(c,g),i.AddNote(x,!0),B=B+b*i.TimeSignature.bottom})}),i.AddNote(new C(h),!0)}})}function Ee(i,e){let t=0;for(let[n,s]of i)s.forEach(o=>{let r=o.Duration,a=o.Duration/e;t=a;let u=o.Beat;o.Duration=a,o.Tuple=!0;let f={StartBeat:o.Beat,EndBeat:o.Beat+r*n.TimeSignature.bottom,Value:r,Count:e};o.TupleDetails=f;for(let l=1;l<e;l++){let h=new C({Beat:u+a*n.TimeSignature.bottom,Duration:a,Line:o.Line,Rest:!0,Tied:!1,Staff:o.Staff,Tuple:!0,TupleDetails:f,Clef:I(n,u+a*n.TimeSignature.bottom,o.Staff)});u=h.Beat,n.AddNote(h,!0)}});return t}var me=class{constructor(e,t,n=!1){this.Selected=!1,this.SelType=3,this.top=e,this.bottom=t,this.Editable=!0,this.TopPosition={x:0,y:0},this.BotPosition={x:0,y:0},this.GTopPosition={x:0,y:0},this.GBotPosition={x:0,y:0},this.Bounds=new D(0,0,0,0),this.GBounds=new D(0,0,0,0)}render(e,t){let n=xe(this.top),s=xe(this.bottom),o=this.Selected?"#1065b0":"black";v(e,n,this.TopPosition.x,this.TopPosition.y,o),v(e,s,this.BotPosition.x,this.BotPosition.y,o),t.Instrument.Staff===1&&(v(e,n,this.GTopPosition.x,this.GTopPosition.y,o),v(e,s,this.GBotPosition.x,this.GBotPosition.y,o))}SetBounds(e,t){if(t===0){let n=p.GetMeasureMidLine(e);this.Bounds.x=e.Bounds.x+e.XOffset-25,this.Bounds.y=e.Bounds.y+(n-4)*5,this.Bounds.width=30,this.Bounds.height=50,this.TopPosition.x=this.Bounds.x,this.TopPosition.y=e.Bounds.y+(n-2)*5,this.BotPosition.x=this.Bounds.x,this.BotPosition.y=e.Bounds.y+(n+2)*5}else{let n=e.GetGrandMeasureMidLine();this.GBounds.x=e.Bounds.x+e.XOffset-25,this.GBounds.y=e.Bounds.y+e.GetMeasureHeight()+(n-4)*5,this.GBounds.width=30,this.GBounds.height=50,this.GTopPosition.x=this.Bounds.x,this.GTopPosition.y=e.Bounds.y+e.GetMeasureHeight()+(n-2)*5,this.GBotPosition.x=this.Bounds.x,this.GBotPosition.y=e.Bounds.y+e.GetMeasureHeight()+(n+2)*5}}IsHovered(e,t,n){return this.Bounds.IsHovered(e,t,n)||this.GBounds.IsHovered(e,t,n)}};function xe(i){let e;switch(i){case 0:e="\uE080";break;case 1:e="\uE081";break;case 2:e="\uE082";break;case 3:e="\uE083";break;case 4:e="\uE084";break;case 5:e="\uE085";break;case 6:e="\uE086";break;case 7:e="\uE087";break;case 8:e="\uE088";break;case 9:e="\uE089";break}return e}function we(i){return new me(i.top,i.bottom)}var p=class i{constructor(e,t){this.Clefs=[];this.GrandClefs=[];this.Message=e.Message,this.RunningID=t,this.ID=0,this.Selected=!1,this.Editable=!0,this.SelType=0,this.Instrument=e.Instrument,this.Line=0,this.Bounds=e.Bounds,this.TimeSignature=we(e.TimeSignature),this.KeySignature=e.KeySignature,this.Notes=e.Notes,this.BNotes=[],this.Divisions=[],this.BDivisions=[],this.RenderClef=e.RenderClef,this.RenderKey=e.RenderKey,this.Camera=e.Camera,this.RenderTimeSig=e.RenderTimeSig,this.Page=e.Page,this.PageLine=e.Page.PageLines[0].Number,this.PrefBoundsY=this.Bounds.y,this.PrevBoundsH=this.Bounds.height,this.SetXOffset(),this.SALineTop=5,this.SALineMid=15,this.SALineBot=30,this.SALineTopSave=this.SALineTop,this.SALineBotSave=this.SALineBot,this.SALineTopDef=this.SALineTop,this.SALineBotDef=this.SALineBot,this.SBLineTop=1035,this.SBLineMid=1045,this.SBLineBot=1054,this.SBLineTopSave=this.SBLineTop,this.SBLineBotSave=this.SBLineBot,this.SBLineTopDef=this.SBLineTop,this.SBLineBotDef=this.SBLineBot,this.SBOffset=1e3,this.CreateDivisions(this.Camera);let n=new j(0,{x:this.Bounds.x+16,y:this.Bounds.y+(5*i.GetMeasureMidLine(this)+10*2)},"treble",1);if(n.SetBounds(this,0),this.Clefs.push(n),this.Instrument.Staff===1){let s=new j(1,{x:this.Bounds.x+30,y:this.Bounds.y+this.GetMeasureHeight()+this.GetGrandMeasureMidLine()*5-2},"bass",1);s.SetBounds(this,1),this.GrandClefs.push(s)}this.TimeSignature.SetBounds(this,0),this.TimeSignature.SetBounds(this,1)}static GetLineHovered(e,t){let n=t.Camera,s=e-t.Bounds.y-n.y,o=Math.floor(s/5),r=o+t.SALineTop,a=new D(t.Bounds.x,0,t.Bounds.width+t.XOffset,5);if(r>t.SALineBot){let u=r-t.SALineBot;r=t.SBLineTop+u,a.y=t.Bounds.y+t.GetMeasureHeight()+(u*5-2.5)}else a.y=t.Bounds.y+(o*5-2.5);return{num:r,bounds:a}}static GetNotePositionOnLine(e,t){let n=e.Camera,s=0;return t<=e.SALineBot?s=e.Bounds.y+(t-e.SALineTop)*5:s=e.Bounds.y+e.GetMeasureHeight()+(t-e.SBLineTop)*5,s-2.5}static GetMeasureHeight(e,t){return(e.SALineTop+e.SALineBot)*5}static GetMeasureMidLine(e){return e.SALineMid-e.SALineTop}GetBoundsWithOffset(){return new D(this.Bounds.x,this.Bounds.y,this.Bounds.width+this.XOffset,this.Bounds.height)}SetXOffset(){this.XOffset=0,this.RenderClef&&(this.XOffset+=30),this.RenderKey&&(this.XOffset+=30),this.RenderTimeSig&&(this.XOffset+=30)}CreateDivisions(e,t=!1){t&&this.ResetHeight(),this.Divisions=[],this.Divisions.push(...ue(this,this.Notes,0,e)),this.Instrument.Staff===1&&(this.Divisions.push(...ue(this,this.Notes,1,e)),le(this,this.Divisions,1)),le(this,this.Divisions,0),G(this,0),G(this,1)}Reposition(e){this.Bounds.x=e.Bounds.x+e.Bounds.width+e.XOffset,this.CreateDivisions(this.Camera)}GetMeasureHeight(){return(this.SALineTop<0?this.SALineBot+Math.abs(this.SALineTop):this.SALineBot-this.SALineTop)*5}GetGrandMeasureHeight(){let t=this.GetMeasureHeight(),s=this.SBLineTop-this.SBOffset<0?this.SBLineBot-this.SBOffset+Math.abs(this.SBLineTop-this.SBOffset):this.SBLineBot-this.SBOffset-(this.SBLineTop-this.SBOffset);return t+s*5}GetGrandMeasureMidLine(){return this.SBLineMid-this.SBLineTop}ResetHeight(){let e=this.Instrument.Staff===0?this.GetMeasureHeight():this.GetGrandMeasureHeight();this.Bounds.height=e,this.PrevBoundsH=e,this.SALineTop=this.SALineTopSave,this.SALineBot=this.SALineBotSave,this.SBLineTop=this.SBLineTopSave,this.SBLineBot=this.SBLineBotSave,this.Bounds.y=this.PrefBoundsY}ReHeightenTop(e,t){if(e){let n=t-this.SALineTop;this.SALineTop=t-n-1,this.Bounds.y-=5,this.Bounds.height+=5}else t>=this.SALineTopSave?(this.SALineTop=this.SALineTopSave,this.Bounds.y=this.PrefBoundsY):(this.SALineTop+=1,this.Bounds.y+=5);this.CreateDivisions(this.Camera)}ReHeightenBot(e,t){e?(this.SALineBot=t+2,this.Bounds.height+=5):t<=this.SALineBotSave?(this.SALineBot=this.SALineBotSave,this.Bounds.height=this.PrevBoundsH):(this.SALineBot-=1,this.Bounds.height-=5),this.CreateDivisions(this.Camera)}ReHeightenTopGrand(e,t){if(e){let n=t-this.SBLineTop;this.SBLineTop=t-n-1,this.Bounds.y-=5,this.Bounds.height+=5}else t>=this.SBLineTopSave?(this.SBLineTop=this.SBLineTopSave,this.Bounds.y=this.PrefBoundsY):(this.SBLineTop+=1,this.Bounds.y+=5);this.CreateDivisions(this.Camera)}ReHeightenBotGrand(e,t){e?(this.SBLineBot=t+2,this.Bounds.height+=5):t<=this.SBLineBotSave?(this.SBLineBot=this.SBLineBotSave,this.Bounds.height=this.PrevBoundsH):(this.SBLineBot-=1,this.Bounds.height-=5),this.CreateDivisions(this.Camera)}ResetTopHeight(){this.SALineTop=this.SALineTopSave,this.Bounds.y=this.PrefBoundsY,this.Bounds.height=this.PrevBoundsH,this.CreateDivisions(this.Camera)}AddNote(e,t=!1){if(e.Rest?this.ClearNonRestNotes(e.Beat,e.Staff):this.ClearRestNotes(e.Beat,e.Staff),e.SetID(this.RunningID.count),this.RunningID.count++,this.Notes.push(e),t){let n={messageString:"AddNote",messageData:{Message:{msg:"AddingNote",obj:e},MessageType:4}};this.Message(n)}}ClearNonRestNotes(e,t){for(let n=this.Notes.length-1;n>=0;n--)this.Notes[n].Beat===e&&this.Notes[n].Rest===!1&&this.Notes[n].Staff===t&&this.Notes.splice(n,1)}ClearRestNotes(e,t){for(let n=this.Notes.length-1;n>=0;n--)this.Notes[n].Beat===e&&this.Notes[n].Rest===!0&&this.Notes[n].Staff===t&&this.Notes.splice(n,1)}ClearMeasure(e){for(let t=this.Notes.length-1;t>=0;t--)this.Notes[t].Editable&&!e.includes(this.Notes[t])&&this.Notes.splice(t,1)}DeleteSelected(){for(let e=this.Notes.length-1;e>=0;e--)if(this.Notes[e].Selected){let t=this.Notes[e].Beat,n=this.Notes[e].Duration,s=this.Notes[e].Staff,o=this.Notes[e].Tuple,r=this.Notes[e].TupleDetails;if(this.Notes.splice(e,1),this.Notes.filter(u=>u.Beat===t).length===0){let u=I(this,t,s),f={Beat:t,Duration:n,Line:15,Rest:!0,Tied:!1,Staff:s,Tuple:o,TupleDetails:r,Clef:u};this.AddNote(new C(f))}}}GetMinimumWidth(){if(this.Notes.filter(o=>o.Rest!==!0).length===0)return _*4;let e=this.Divisions.filter(o=>o.Staff===0),t=this.Divisions.filter(o=>o.Staff===1);return 1/this.Divisions.sort((o,r)=>o.Duration-r.Duration)[0].Duration*_}ReturnSelectableElements(){let e=[];return e.push(...this.Notes),e.push(...this.Clefs),e}IsHovered(e,t,n){return this.GetBoundsWithOffset().IsHovered(e,t,n)}ChangeTimeSignature(e,t,n){this.TimeSignature.top=e,this.TimeSignature.bottom=t}};var J=class{constructor(e){this.Bounds=e}Render(e,t,n){n?e.fillStyle=n:e.fillStyle="black",e.fillRect(this.Bounds.x,this.Bounds.y,this.Bounds.width,this.Bounds.height)}};var Se="m0 0 0-5.6448 2.4-.6624 0 5.616-2.4.6912zm4.7256-1.3656-1.65.4728 0-5.616 1.65-.4608 0-2.3328-1.65.4608 0-5.7382-.6756 0 0 5.9122-2.4.69 0-5.5798-.6372 0 0 5.7922-1.65.462 0 2.3376 1.65-.4608 0 5.6052-1.65.4596 0 2.328 1.65-.4608 0 5.7058.6372 0 0-5.9098 2.4-.66 0 5.551.6756 0 0-5.7598 1.65-.462 0-2.3364z",Dt="c-1.2495-.1955-2.5177-.1955-3.7791-.1938-.0272-.9231.1207-1.904-.2448-2.771-.2448-.5763-.7089-1.0302-1.1203-1.4977-.6579.5882-1.1985 1.3651-1.2512 2.2678-.051.6664-.0136 1.3345-.0255 2.0009-1.2614.0187-2.5347-.0425-3.7791.2057.2397-1.2376.1853-2.5024.2074-3.7553.9605-.0255 1.9873.1122 2.8798-.306.5253-.2465.9724-.6324 1.4178-.9996-.5814-.6579-1.3362-1.2376-2.2474-1.292-.6817-.0544-1.3668-.0153-2.0502-.0272-.0425-1.2444.102-2.5024-.1564-3.7315 1.2308.2227 2.4854.1649 3.7281.1819.0187.8857-.0799 1.8037.17 2.6554.1904.6511.7106 1.1526 1.1441 1.666.6137-.5338 1.1662-1.2036 1.2665-2.0417.0918-.7582.0187-1.5198.0612-2.2797 1.2529-.034 2.5432.1258 3.7553-.2703-.1802 1.2631-.1972 2.5466-.1836 3.8199-.8942.0255-1.8309-.0748-2.6809.2278-.646.2278-1.1543.7276-1.6677 1.1696.5576.5712 1.2291 1.0965 2.0587 1.1747.7616.0714 1.5266.0391 2.2899.0527.0187 1.2495-.0425 2.5109.2074 3.7434z",Q="c0 .805-.3018 1.576-1.1298 2.6109-.8772 1.0963-1.6156 1.7237-2.5886 2.4615l0-4.8049c.2212-.5586.5474-1.0108.98-1.358.4312-.3458.868-.5194 1.3104-.5194.7308 0 1.1942.4144 1.3944 1.2404.0224.0672.0336.1904.0336.3696zm-.105-3.36c-.6034 0-1.2166.1666-1.841.5012-.6244.3332-1.2152.7798-1.7724 1.3356l0-10.1804-.7882 0 0 17.4367c0 .4928.1344.7392.4032.7392.1554 0 .3485-.1302.637-.3024.8166-.4873 1.3257-.8131 1.8788-1.1567.6308-.392 1.3412-.8497 2.2806-1.7457.6482-.651 1.1172-1.3076 1.4084-1.9684.2898-.6622.4354-1.3174.4354-1.9684 0-.9632-.2562-1.6478-.7686-2.0524-.5796-.4256-1.2054-.6384-1.8732-.6384z",pt="m0 0-.7875.2813 0-6.4406-4.5281 1.9688 0-16.7063.7594-.3375 0 6.5531 4.5563-2.0813 0 16.7625zm-.7875-9 0-4.5-3.7688 1.6594 0 4.5 3.7688-1.6594z";function Ge(i,e,t){let{canvas:n,context:s,camera:o}=i,r="",a="";switch(t){case 0:r=`m ${e.Bounds.x+o.x-2} ${e.Bounds.y+o.y+16}`,r+=pt;break;case 1:r=`m ${e.Bounds.x+o.x-6} ${e.Bounds.y+o.y+8}`,r+=Se,v(i,"\uE262",e.Bounds.x-12,e.Bounds.y+3);break;case 2:r=`m ${e.Bounds.x+o.x-2} ${e.Bounds.y+o.y+10}`,r+=Dt;break;case-2:a=`m ${e.Bounds.x+o.x-15} ${e.Bounds.y+o.y+4}`,a+=Q;case-1:r=`m ${e.Bounds.x+o.x-5} ${e.Bounds.y+o.y+4}`,r+=Q;break;default:break}s.fillStyle="black"}var Lt="c-.2863.1212-.4577.5392-.326.8318.0397.0418.4556.5392.8736 1.0868.9551 1.0764 1.1182 1.3313 1.3292 1.8288.8339 1.7054.3762 3.877-1.0847 5.2501-.1233.163-.6625.6186-1.1683.9948-1.4525 1.2498-2.1214 1.9604-2.368 2.5874-.0899.1651-.0899.3281-.0899.581-.0397.5789 0 .6291 1.7159 2.6209 2.3262 2.7922 3.9919 4.7506 4.1215 4.8739l.1233.1212-.163-.0815c-2.2948-.9551-4.8739-1.4128-5.7475-.9948-.2947.1212-.4661.2926-.5873.5789-.3365.7106-.2466 1.7556.2529 3.2897.4556 1.3794 1.371 3.2082 2.2844 4.5813.3762.5873 1.0868 1.5006 1.1683 1.5424.1233.1233.2947.0815.4159 0 .1233-.163.1233-.2947-.1212-.5789-.8736-1.2498-1.2895-3.8372-.7921-5.2104.2027-.6186.4577-.9551.9133-1.1662 1.208-.5392 3.879.1296 4.9972 1.2477.0815.0836.2529.255.3344.2947.2947.1233.7106-.0397.8339-.3344.1714-.2947.0815-.4974-.2947-.9551-.7022-.8339-2.8257-3.3315-3.1183-3.7077-.7524-.8736-1.0868-1.7054-1.1683-2.7504-.0397-1.3313.4974-2.7421 1.5027-3.6659.1212-.163.6604-.6207 1.16-.9948 1.5424-1.2916 2.1715-2.0001 2.416-2.671.1714-.5392.0899-1.0366-.2863-1.4943-.1296-.1212-1.5842-1.9186-3.2897-3.9585-2.3345-2.7442-3.1684-3.7474-3.2897-3.7892-.1714-.0397-.3762-.0397-.5476.0418z",Tt="c-.884.1666-1.5606.7769-1.8666 1.6201-.0663.272-.0663.3383-.0663.7106 0 .5117.0323.7837.272 1.1883.3383.6783 1.0489 1.2223 1.8598 1.4212.85.2397 2.2712.034 3.8981-.5049l.4046-.1394-1.9992 5.525-1.9652 5.5182c0 0 .0663.034.1734.1071.1989.1326.5372.2329.7769.2329.4046 0 .9163-.2329.9826-.4386 0-.0663.9486-3.2878 2.0978-7.1128l2.0315-7.0125-.0663-.0986c-.1649-.2057-.5032-.272-.7106-.1071-.0663.0663-.1717.2057-.238.306-.306.5117-1.0829 1.4212-1.4875 1.7595-.3723.306-.578.3383-.9163.2057-.306-.1666-.4063-.3383-.612-1.2546-.1989-.9095-.4369-1.3226-.9486-1.6609-.4726-.3043-1.0829-.4046-1.6201-.2652z",Mt="c-.6228.1176-1.1016.5484-1.3116 1.1436-.0516.192-.0516.2388-.0516.5016 0 .3612.0228.5532.192.8388.2388.4788.7404.8628 1.3176 1.0032.5952.1692 1.5504.0468 2.7-.3324.168-.0708.3084-.1224.3084-.0984 0 .0276-1.0728 3.516-1.1196 3.6372-.1224.3096-.5304.882-.8868 1.242-.3324.3336-.5016.408-.7632.2868-.216-.1176-.2868-.24-.432-.8868-.1212-.4776-.2148-.7404-.4068-.9276-.5016-.5532-1.3644-.624-2.0304-.192-.3144.2148-.5532.5484-.6936.9096-.0516.1872-.0516.2388-.0516.5004 0 .3564.0276.5496.192.8352.2388.4776.7404.8628 1.3176 1.0032.2628.0744.9324.0744 1.3872 0 .3792-.0708.834-.1884 1.2888-.3336.192-.0696.3612-.1164.3612-.0936 0 0-2.3436 7.6272-2.3904 7.7436 0 .024.1872.1692.3792.216.192.0756.3852.0756.5772 0 .1872-.0468.3792-.1644.3792-.2388.024-.024.9804-3.6324 2.1516-8.0112l2.1288-7.9596-.0468-.0696c-.0948-.1452-.2868-.1692-.4548-.0984-.0948.0468-.0948.0468-.3804.4776-.2388.384-.576.7872-.768.9792-.2628.216-.4032.2628-.6432.1692-.2148-.1176-.2904-.2388-.4308-.8856-.1452-.642-.3144-.9336-.6708-1.1724-.3324-.2148-.7632-.2856-1.1484-.1872z",Ct="m0 0c-.516.101-.918.461-1.094.957-.043.16-.043.199-.043.418 0 .218 0 .3.043.418.137.441.418.777.856.976.297.16.437.18.855.18.52 0 .957-.078 1.657-.297.179-.063.316-.102.316-.102.019 0-.16.7-.399 1.536-.296 1.175-.417 1.554-.457 1.671-.16.301-.5.758-.718.957-.2.18-.317.219-.516.141-.18-.098-.242-.199-.359-.738-.102-.399-.18-.617-.34-.778-.418-.457-1.137-.515-1.692-.156-.261.176-.46.457-.578.754-.043.16-.043.199-.043.418 0 .301.024.461.161.699.199.399.617.719 1.097.836.219.063.778.063 1.156 0 .317-.058.696-.16 1.075-.277.179-.059.32-.102.32-.102 0 .02-.797 3.051-.84 3.11-.156.34-.476.758-.715.996-.258.258-.398.301-.617.219-.18-.098-.242-.2-.359-.739-.102-.398-.18-.617-.34-.773-.418-.461-1.137-.52-1.692-.16-.261.179-.46.457-.578.758-.043.156-.043.199-.043.417 0 .219 0 .297.043.418.137.438.418.778.856.977.32.16.437.18.875.18.32 0 .422 0 .679-.043.36-.059.739-.176 1.157-.297l.258-.102v.063c-.02.078-1.696 6.375-1.715 6.414-.02.082.34.238.558.238.219 0 .539-.137.559-.238.019-.02.976-4.145 2.172-9.164 2.133-9.086 2.133-9.106 2.094-9.168-.063-.078-.161-.117-.282-.117-.14.019-.199.078-.34.316-.277.481-.597.898-.773 1.039-.121.078-.223.078-.379.02-.18-.102-.242-.2-.359-.739-.121-.539-.262-.777-.559-.976-.277-.18-.637-.238-.957-.16z",Nt="c11.7122 2.9669 6.3069 13.252 5.2534 16.885 9.622-13.142-5.1221-18.5026-5.2534-26.47z",Rt="c10.7362-2.7197 5.7813-12.1477 4.8156-15.4779 8.8202 12.0469-4.6953 16.9607-4.8156 24.2642z",A=9;function ce(i,e,t,n,s,o,r="black"){i.Accidental!==0&&Ge(e,i,i.Accidental);let{x:a,y:u,width:f,height:l}=t,{canvas:h,context:d,camera:m}=e,c=s?o===0?11:-11:0,g=`m ${a+m.x} ${u+7.5-1+m.y}`;u=u+3,r=i.Editable?r:"black",r=n?"#1065b0":r;let S="";switch(i.Duration){case .125:case .25:v(e,"\uE0A4",a,u,r);break;case .5:v(e,"\uE0A3",a,u,r);break;case 1:v(e,"\uE0A2",a-2.5,u,r);break;default:v(e,"\uE0A4",a,u,r)}d.fillStyle="black",n&&(d.fillStyle="black"),!1&&(d.fillStyle="rgba(200, 0, 0, 0.5)",d.fillRect(a+m.x,u+m.y-5,f,l),d.fillStyle="black")}function He(i,e,t){let{canvas:n,context:s,camera:o}=i,r=0;switch(e.Duration){case .046875:case .09375:case .1875:case .375:case .75:case 1.5:r=1;break;case .0546875:case .109375:case .21875:case .4375:case .875:case 1.75:r=2;break;case .05859375:case .1171875:case .234375:case .46875:case .9375:case 1.875:r=3;break;default:r=0}let a="a1.485 1.485 90 10-2.97 0 1.485 1.485 90 102.97 0";for(let u=0;u<r;u++){let f=e.Line*5;e.Line%2!==0&&(f=(e.Line-1)*5);let l=`m${t+o.x+17+u*5} 
      ${f+o.y}`+a;s.fill(new Path2D(l))}}function ge(i,e,t,n,s){i.fillStyle="black";let o=e.Bounds.x+t.x+A,r=p.GetNotePositionOnLine(s,n.Line-3)+t.y,a=`m${o} ${r}`;i.fillStyle=n.Selected?"#1065b0":"black",e.Duration===.3125?(r+=7,a=`m ${o} ${r}`+Ct,i.fill(new Path2D(a))):e.Duration===.0625?(r+=9,a=`m ${o} ${r}`+Mt,i.fill(new Path2D(a))):e.Duration>.0625&&e.Duration<=.125?(r=r+10,a=`m${o} ${r}`+Tt,i.fill(new Path2D(a))):e.Duration===.25?(a=a+Lt,i.fill(new Path2D(a))):e.Duration===.5?(r=p.GetNotePositionOnLine(s,n.Line)-6+t.y,i.fillRect(o,r,14,6)):e.Duration===1&&(r=p.GetNotePositionOnLine(s,n.Line-2)+t.y,o=e.Bounds.x+t.x+e.Bounds.width/2-7,i.fillRect(o,r,14,6))}function yt(i,e,t){let{canvas:n,context:s,camera:o}=i,r=e.x2-e.x1;s.fillStyle="#75757",s.fillRect(e.x1+o.x,e.y1-12+o.y,1,6),s.fillRect(e.x1+o.x,e.y1-12+o.y,r/2-14,1),s.fillRect(e.x1+r+o.x,e.y1-12+o.y,1,6),s.fillRect(e.x1+r/2+14+o.x,e.y1-12+o.y,r/2-14,1),v(i,vt(t),e.x1+r/2-7,e.y1-5)}function vt(i){switch(i){case"0":return"\uE880";case"1":return"\uE881";case"2":return"\uE882";case"3":return"\uE883";case"4":return"\uE884";case"5":return"\uE885";case"6":return"\uE886";case"7":return"\uE887";case"8":return"\uE888";case"9":return"\uE889";default:return"\uE883"}}function Be(i,e,t,n,s){let{canvas:o,context:r,camera:a}=i,u=e.filter(c=>c.Staff===n);u.sort((c,g)=>c.Beat-g.Beat);let f=!1,l=0,h=0,d=0,m=0;u.forEach((c,g)=>{let S=t.filter(T=>T.Beat===c.Beat&&T.Staff===n),B=[...S],b=W([S],[c],n,s);if(!S[0].Tuple){f&&(f=!1,yt(i,{x1:l,y1:d,x2:h,y2:d},m.toString()),l=0,h=0,d=0,m=0);return}f||(f=!0,l=c.Bounds.x+9,m=S[0].TupleDetails.Count,d=c.Bounds.y),h=c.Bounds.x+19})}function be(i,e,t,n,s){let{canvas:o,context:r,camera:a}=i,u=e.filter(f=>f.Staff===n);u.sort((f,l)=>f.Beat-l.Beat),u.forEach((f,l)=>{if(l===u.length-1)return;let h=t.filter(m=>m.Beat===f.Beat);h.sort((m,c)=>m.Line-c.Line);let d=t.filter(m=>m.Beat===u[l+1].Beat);d.sort((m,c)=>m.Line-c.Line),h.forEach(m=>{if(!m.Tied||m.Rest||m.Tied&&m.Beat+m.Duration*s.TimeSignature.bottom>m.TiedEnd)return;let c=d.find(x=>x.Line===m.Line&&x.Tied&&x.Beat<=x.TiedEnd);if(c===void 0){console.error("No tied note found: ",m);return}let g=c,S=f.Bounds.x+A+a.x,B=p.GetNotePositionOnLine(s,m.Line)+a.y,b=u[l+1].Bounds.x+A+a.x,T=p.GetNotePositionOnLine(s,g.Line)+a.y,L=m.Line<15?-15:15,M=m.Line<15?-8:8;r.fillStyle="#757575",r.strokeStyle="#757575",r.setLineDash([]),r.beginPath(),r.moveTo(S+A/2,B+M),r.quadraticCurveTo(S+A/2+(b-S)/2,B+L,b+A/2,T+M),r.stroke()})})}function W(i,e,t,n){let s=0;i.sort((f,l)=>f[0].Beat-l[0].Beat);let o=!0;if(e.forEach((f,l)=>{f.Beat!==i[l][0].Beat&&(console.error("Index: ",l),console.error("Match failed on div: ",f),console.error("Match failed on beat: ",f.Beat),console.error("Match fail note: ",i[l][0]),o=!1)}),!o){console.error("Divisions and note array do not match");return}let r=t===0?n.SALineMid:n.SBLineMid,a=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;return i.forEach(f=>{f.forEach(l=>{l.Line<a&&(a=l.Line),l.Line>u&&(u=l.Line)})}),r-a<u-r?s=0:s=1,s}function De(i,e,t,n,s,o,r){let a=!0;if(t.forEach((w,y)=>{w.Beat!==e[y][0].Beat&&(a=!1)}),!a){console.error("Divisions and note array do not match");return}let{canvas:u,context:f,camera:l}=i,h=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER,m=0,c=!1,g=0,S=0,B=0,b=0,T=n===0?p.GetMeasureMidLine(s):s.GetGrandMeasureMidLine(),L=n===0?0+s.SALineTop:s.SBLineTop,M=n===0?s.SALineTop:s.SBLineTop,x=7,F=5;e.forEach(w=>{w.forEach(y=>{y.Line<h&&(h=y.Line),y.Line>d&&(d=y.Line)})}),T-h+M<d-T-M?(m=0,S=t[0].Bounds.y+(h-L)*F-35+l.y,h-M>=T+x&&(c=!0,S=t[0].Bounds.y+T*F+l.y)):(m=1,S=t[0].Bounds.y+(d-L)*F+35+l.y,d-M<=T-x&&(c=!0,S=t[0].Bounds.y+T*F+l.y)),t.forEach((w,y)=>{if(w.Duration===1)return;let rt=m===0?11.5:.25,U=Math.floor(w.Bounds.x+rt+l.x+A);y===0?B=U:y===t.length-1&&(b=U,m===1&&(b+=2));let ae=e[y].sort((X,R)=>X.Line-R.Line),ft=ae[0].Line,ut=ae[ae.length-1].Line,Le=m===0?w.Bounds.y+(ut-L)*F+l.y-2:w.Bounds.y+(ft-L)*F+l.y+2;if(t.length===1&&t[0].Duration<.25){let X=Ae(w.Duration);if(m===0)for(let R=0;R<X;R++){let O=`m${U} ${S+R*8}`;f.fill(new Path2D(O+Nt))}else for(let R=0;R<X;R++){let O=`m${U} ${S-R*8}`;f.fill(new Path2D(O+Rt))}}else if(t.length>1&&t[0].Duration<.25){f.fillStyle="black";let X=0,R=0,O=m===0?10.5:0;if(S=m===0?p.GetNotePositionOnLine(s,h)-35+l.y:p.GetNotePositionOnLine(s,d)+35+l.y,o===0?m===0?(S-=y*(10/(t.length-1)),R=S-10):(S+=y*(10/(t.length-1)),R=S+10):o===2?m===0?(S+=y*(10/(t.length-1)),R=S+10):(S-=y*(10/(t.length-1)),R=S-10):R=S,y===0){let dt=e[0][0].Bounds.x,ht=e[e.length-1][0].Bounds.x;new V(new D(t[0].Bounds.x+19,S,5,5),{x:dt+O,y:S-l.y},{x:ht+O,y:R-l.y}).Render(f,l,Ae(t[0].Duration),m)}}let lt=S-Le;new J(new D(U,Le,1.5,lt)).Render(f,l,r)})}function Ae(i){let e=1;switch(i){case .03125:e=3;break;case .0625:e=2;break;default:}return e}function pe(i,e,t,n,s,o){let{canvas:r,context:a,camera:u}=t,f=e.Bounds.x+A-6+u.x,l="h 22 v 1.5 h-20 v-1.5 Z",h=i.filter(S=>S.Beat===e.Beat&&S.Staff===e.Staff),d=n===0?p.GetMeasureMidLine(s):s.GetGrandMeasureMidLine(),m=n===0?s.SALineMid:s.SBLineMid;if(h.length===0)return;h.sort((S,B)=>S.Line-B.Line);let c=h[0],g=h[h.length-1];a.fillStyle=o||"black";for(let S=m-6;S>=c.Line;S-=2){let B=p.GetNotePositionOnLine(s,S)+u.y+2.5,b=`m ${f} ${B}`+l;a.fill(new Path2D(b))}for(let S=m+6;S<=g.Line;S+=2){let B=p.GetNotePositionOnLine(s,S)+u.y+2.5,b=`m ${f} ${B}`+l;a.fill(new Path2D(b))}}var V=class{constructor(e,t,n){this.Bounds=e,this.StartPoint=t,this.EndPoint=n}Render(e,t,n,s){let r=`M ${this.StartPoint.x+t.x} ${this.StartPoint.y+t.y}
        L${this.EndPoint.x+t.x+2} ${this.EndPoint.y+t.y}
        V${this.EndPoint.y+t.y+6} 
        L${this.StartPoint.x+t.x} ${this.StartPoint.y+6+t.y} z `;e.fill(new Path2D(r));let a=s===0?2.5:-8,u=s===0?6:0;for(let f=1;f<n;f++){let h=`M ${this.StartPoint.x+t.x} ${this.StartPoint.y+u*f+a*f+t.y}
          L${this.EndPoint.x+t.x+2} ${this.EndPoint.y+u*f+a*f+t.y}
          V${this.EndPoint.y+u*f+a*f+t.y+6} 
          L${this.StartPoint.x+t.x} ${this.StartPoint.y+u*f+a*f+6+t.y} z`;e.fill(new Path2D(h))}}};function Fe(i,e,t){let n=e.Divisions.sort((s,o)=>s.Beat-o.Beat);if(t===0){let s=e.Notes[0].sort((r,a)=>r.Line-a.Line)[0].Line,o=e.Notes[e.Notes.length-1].sort((r,a)=>r.Line-a.Line)[0].Line;if(s===o)return 4;if(s<o)return 2;if(s>o)return 0}else{let s=e.Notes[0].sort((r,a)=>r.Line-a.Line)[e.Notes[0].length-1].Line,o=e.Notes[e.Notes.length-1].sort((r,a)=>r.Line-a.Line)[e.Notes[e.Notes.length-1].length-1].Line;if(s===o)return 4;if(s<o)return 0;if(s>o)return 2}return 4}var Et="c -3.4414 -0.2 -6.9551 -2.3586 -9.0565 -4.836 c -2.4363 -2.8725 -3.4408 -6.7778 -3.1835 -9.985 c 0.7559 -9.4235 11.0037 -14.9932 14.7972 -19.1095 c 2.5392 -2.7553 3.0715 -4.0984 3.6387 -5.5155 c 1.098 -2.743 1.2749 -5.9568 -0.902 -6.1967 c -2.0784 -0.2291 -3.7883 3.0395 -4.552 5.2732 c -0.6868 2.0092 -1.1432 4.025 -0.73 7.053 c 0.1857 1.3604 5.2966 39.3342 5.3828 39.9228 c 0.8607 5.8824 -2.5033 8.3164 -5.9373 8.7494 c -7.4156 0.9349 -9.7951 -6.6011 -6.4715 -9.4632 c 2.5587 -2.2037 6.2813 -0.3118 6.0802 3.3111 c -0.1781 3.2088 -3.3245 3.3034 -4.1284 3.2301 c 1.2342 2.2134 10.5383 3.3698 9.1097 -6.6304 c -0.2007 -1.4052 -4.9236 -37.0907 -5.0393 -37.8892 c -0.8664 -5.9781 -0.9984 -10.71 2.1162 -16.232 c 1.1499 -2.0385 2.9671 -3.3545 3.8592 -3.1822 c 0.196 0.0378 0.3914 0.1098 0.5464 0.2698 c 2.3892 2.4618 3.1222 7.921 2.8604 11.057 c -0.268 3.211 -0.4174 6.5351 -3.6102 10.4116 c -1.2356 1.5001 -5.0061 4.8048 -7.1679 6.7035 c -3.0375 2.6676 -5.2407 4.9975 -6.4328 7.8082 c -1.3397 3.1589 -1.5664 7.1354 1.4594 10.6638 c 1.7405 1.9935 4.6284 3.408 7.0589 3.4382 c 6.7579 0.0839 8.7314 -3.2473 8.7945 -7.0198 c 0.1038 -6.2119 -7.3955 -8.5605 -10.4787 -4.2893 c -1.7877 2.4766 -1.0019 5.0833 0.1987 6.3235 c 0.4121 0.4256 0.8724 0.7498 1.3079 0.9306 c 0.1578 0.0655 0.5291 0.2381 0.4237 0.4908 c -0.0876 0.2103 -0.2579 0.2221 -0.413 0.2035 c -1.9443 -0.2332 -4.0972 -2.0916 -4.6266 -5.2883 c -0.7714 -4.6592 3.3402 -10.1861 9.2091 -9.2822 c 3.8423 0.5918 7.4097 3.8979 7.0969 10.0543 c -0.2683 5.2764 -4.6425 9.4065 -11.2101 9.0248 z";function Oe(i,e){return`m ${i} ${e} ${Et}`}var ke=new Map([["CMaj/Amin",[]],["GMaj/Emin",["F#"]],["DMaj/Bmin",["F#","C#"]],["AMaj/F#min",["F#","C#","G#"]],["EMaj/C#min",["F#","C#","G#","D#"]],["BMaj/G#min",["F#","C#","G#","D#","A#"]],["F#Maj/D#min",["F#","C#","G#","D#","A#","E#"]],["C#Maj/A#min",["F#","C#","G#","D#","A#","E#","B#"]],["FMaj/Dmin",["Bb"]],["BbMaj/Gmin",["Bb","Eb"]],["EbMaj/Cmin",["Bb","Eb","Ab"]],["AbMaj/Fmin",["Bb","Eb","Ab","Db"]],["DbMaj/Bbmin",["Bb","Eb","Ab","Db","Gb"]],["GbMaj/Ebmin",["Bb","Eb","Ab","Db","Gb","Cb"]],["CbMaj/Abmin",["Bb","Eb","Ab","Db","Gb","Cb","Fb"]]]);function $e(i,e,t,n,s){let{canvas:o,context:r,camera:a}=i;r.fillStyle="black";let u=Pt(n,t),f="";u.Lines.forEach((l,h)=>{u.Accidental==="#"?(f=`m ${e.Bounds.x+s+h*5+a.x+5} 
          ${e.Bounds.y+l*5+a.y+4}`,f+=Se):(f=`m ${e.Bounds.x+s+h*5+a.x-5} 
          ${e.Bounds.y+l*5+a.y+4}`,f+=Q),r.fill(new Path2D(f))})}function Pt(i,e){let t={Accidental:"",Lines:[]},n=ke.get(e),s="";switch(n.length>0&&(n[0].includes("#")?s="#":s="b"),t.Accidental=s,i){case"bass":break;case"treble":t.Lines=xt(n,s);break;default:}return t}function xt(i,e){let t=[];return e==="#"?t=[11,14,10,13,16,12,15].slice(0,i.length):t=[15,12,16,13,17,14,18].slice(0,i.length),t}var E=10,ze=1,z=2;var je=9;function Ke(i,e,t,n,s,o,r,a,u){wt(i,e,t,n,o,a,u),Gt(i,e,n,s),Xe(i,e,0),i.Instrument.Staff===1&&Xe(i,e,1)}function wt(i,e,t,n,s,o,r){let{canvas:a,context:u,camera:f}=e,l=p.GetLineHovered(n.y,i);i.Divisions.concat(i.BDivisions).forEach(d=>{if(d.Bounds.IsHovered(n.x,n.y,f)&&s&&!o){let m=i.Bounds.y+l.num*(E/2),c={Beat:d.Beat,Duration:r,Line:l.num,Rest:!1,Tied:!1,Staff:d.Staff,Tuple:!1,TupleIndex:0,TupleCount:1,Clef:"treble"},g=new C(c);ce(g,e,new D(d.Bounds.x+je,l.bounds.y,0,0),!0,!1,0),De(e,[[g]],[d],d.Staff,i,4,"#1065b0"),pe([g],d,e,d.Staff,i,"#1065b0")}})}function Gt(i,e,t,n){let{canvas:s,context:o,camera:r}=e;i.Selected&&(o.fillStyle="rgba(0, 0, 100, 0.1)",o.fillRect(i.Bounds.x+r.x,i.Bounds.y+r.y,i.Bounds.width+i.XOffset,i.Bounds.height));let a=15-i.SALineTop,u=i.GetGrandMeasureMidLine();o.fillStyle="black";let f=n?z*2:z,l=i.GetGrandMeasureHeight(),h=i.Instrument.Staff===1?l:i.GetMeasureHeight(),d=i.Bounds.y+(5*a-E*2),c=(i.Instrument.Staff===1?i.Bounds.y+i.GetMeasureHeight()+(5*u+E*2):i.Bounds.y+(5*a+E*2))-d,g=`M${i.Bounds.x+r.x} 
          ${i.Bounds.y+5*a-E*2+r.y} h 
          ${z} v ${c} h -${z} Z`,S=`M${i.Bounds.x+i.Bounds.width+i.XOffset+r.x} 
        ${i.Bounds.y+5*a-E*2+r.y} h 
        ${f} v ${c+1} h -${f} Z`,B=`M${i.Bounds.x+i.Bounds.width+i.XOffset+r.x-4} 
          ${i.Bounds.y+5*a-E*2+r.y} h 
          ${z} v ${c+1} h -${z} Z`;for(let b=0;b<5;b++){let T=`M${i.Bounds.x+r.x} 
          ${i.Bounds.y+5*a-E*2+E*b+r.y} h 
          ${i.Bounds.width+i.XOffset} v ${ze} h -${i.Bounds.width+i.XOffset} Z`,L=new Path2D(T);o.fill(L)}if(i.Instrument.Staff===1)for(let b=0;b<5;b++){let T=`M${i.Bounds.x+r.x} 
            ${i.Bounds.y+i.GetMeasureHeight()+5*i.GetGrandMeasureMidLine()-E*2+E*b+r.y} 
            h ${i.Bounds.width+i.XOffset} v ${ze} h -${i.Bounds.width+i.XOffset} Z`,L=new Path2D(T);o.fill(L)}if(o.fill(new Path2D(g)),o.fill(new Path2D(S)),n&&o.fill(new Path2D(B)),i.RenderClef&&At(e,i),i.RenderKey)if("CMaj/Amin"!=="CMaj/Amin"){let T=i.RenderClef?24:4;$e(e,i,"CMaj/Amin","treble",T)}else i.RenderKey=!1;if(i.RenderTimeSig){let b=i.RenderClef?i.RenderKey?48:36:4;Ht(e,i,"4","4",b)}}var Ue="m0 0c0-1.0208.8096-1.8304 1.8304-1.8304s1.8304.8096 1.8304 1.8304-.8096 1.8304-1.8304 1.8304-1.8304-.8096-1.8304-1.8304zm0-8.8c0-1.0208.8096-1.8304 1.8304-1.8304s1.8304.8096 1.8304 1.8304-.8096 1.8304-1.8304 1.8304-1.8304-.8096-1.8304-1.8304zm-11.3696-4.7872c6.0192 0 10.2784 3.0272 10.2784 8.7296 0 9.2576-9.2928 14.608-18.1984 18.3392-.0704.0704-.176.1056-.2816.1056-.2112 0-.3872-.176-.3872-.3872 0-.1056.0352-.2112.1056-.2816 7.1456-4.1536 14.608-9.328 14.608-17.3888 0-4.2592-2.2528-8.3424-6.1248-8.3424-2.7808 0-4.8576 2.0064-5.7728 4.6816.4928-.2816.9856-.4576 1.5136-.4576 1.936 0 3.52 1.584 3.52 3.52 0 2.0416-1.5488 3.7664-3.52 3.7664-2.112 0-3.9424-1.6896-3.9424-3.7664 0-4.6464 3.6256-8.5184 8.2016-8.5184z";function At(i,e){let{canvas:t,context:n,camera:s}=i,o=p.GetMeasureMidLine(e),r=e.GetGrandMeasureMidLine();e.Clefs.forEach(a=>{if(a.Beat===1)a.render(i);else{let u=e.Divisions.find(f=>f.Beat===a.Beat);if(a.Type!=="treble"){if(a.Type==="bass"){let f=`m ${u.Bounds.x+s.x} 
            ${e.Bounds.y+s.y+o*5-5}`+Ue;n.fill(new Path2D(f))}}}}),e.GrandClefs.forEach(a=>{if(a.Beat===1)a.Type==="treble"||a.Type==="bass"&&a.render(i);else{let u=e.Divisions.find(f=>f.Beat===a.Beat);if(a.Type==="treble"){let f=Oe(u.Bounds.x+s.x,e.Bounds.y+s.y+(225+E*2));n.fill(new Path2D(f))}else if(a.Type==="bass"){let f=`m ${u.Bounds.x+s.x} 
            ${e.GetMeasureHeight()+s.y+e.GetGrandMeasureMidLine()*5-5}`+Ue;n.fill(new Path2D(f))}}})}function Ht(i,e,t,n,s){e.TimeSignature.render(i,e)}function Xe(i,e,t){let{canvas:n,context:s,camera:o}=e;i.Divisions.filter(u=>u.Staff===t).forEach((u,f)=>{let l=i.Notes.filter(h=>h.Beat===u.Beat&&h.Staff===u.Staff);if(l.sort((h,d)=>h.Line-d.Line),de(u.Beat,l,u.Staff)){ge(s,u,o,l[0],i);return}pe(i.Notes,u,e,t,i)}),q(i,t).DivGroups.forEach((u,f)=>{if(u.Divisions.length>0){let l=W(u.Notes,u.Divisions,t,i),h=Fe(i,u,l);De(e,u.Notes,u.Divisions,t,i,h),u.Divisions.forEach(d=>{let m=!1,c=i.Notes.filter(g=>g.Beat===d.Beat&&g.Staff===t);c.sort((g,S)=>g.Line-S.Line),c.forEach((g,S)=>{let B=i.Bounds.y+(g.Line-i.SALineTop)*5,b=he(c,S,l);b&&(m=!0);let T=b?l===0?11:-11:0;g.Rest?ge(s,d,o,g,i):ce(g,e,g.Bounds,g.Selected,b,l)}),c.forEach(g=>{let S=m&&l===0?11:0;He(e,g,d.Bounds.x+je+S)})})}}),be(e,i.Divisions,i.Notes,0,i),Be(e,i.Divisions,i.Notes,0,i),i.Instrument.Staff===1&&(be(e,i.Divisions,i.Notes,1,i),Be(e,i.Divisions,i.Notes,1,i))}function he(i,e,t){let n=!1,s=0,o=0,r=i[e].Line;if(i.length<=1)return n;for(let f=e+1;f<=i.length-1;f++){let l=i[f].Line;if(l-r===f-e||l-r===e-e)o++;else break}for(let f=e-1;f>=0;f--){let l=i[f].Line;if(r-l===e-f||r-l===e-e)s++;else break}let a=s+o+1,u=s+1;return a%2===0?n=t===0?u%2!==0:u%2===0:n=u%2===0,n}function Ze(i,e,t,n,s,o){let a=i.Bounds.width,u=i.Bounds.height,f=i.Bounds.x,l=i.Bounds.y;if(t.save(),t.setTransform(1,0,0,1,0,0),t.filter="blur(4px)",t.fillStyle="rgb(71, 71, 71)",t.fillRect(f+n.x-8,l+n.y+8,a,u),t.filter="none",t.fillStyle="white",t.fillRect(f+n.x,l+n.y,a,u),s){t.strokeStyle="rgba(51, 2, 16, 0.2)",t.beginPath(),t.setLineDash([10,10]),t.moveTo(f+i.Margins.left+n.x,l+n.y),t.lineTo(f+i.Margins.left+n.x,l+u+n.y),t.stroke(),t.beginPath(),t.setLineDash([10,10]),t.moveTo(f+a-i.Margins.right+n.x,l+n.y),t.lineTo(f+a-i.Margins.right+n.x,l+u+n.y),t.stroke(),t.beginPath(),t.setLineDash([10,10]),t.moveTo(f+n.x,l+i.Margins.top+n.y),t.lineTo(f+a+n.x,l+i.Margins.top+n.y),t.stroke(),t.beginPath(),t.setLineDash([10,10]),t.moveTo(f+n.x,l+u-i.Margins.bottom+n.y),t.lineTo(f+a+n.x,l+u-i.Margins.bottom+n.y),t.stroke(),t.strokeStyle="black";let h="rgba(51, 2, 16, 0.8)",d="rgba(2,51,16,0.8)";H(f+i.Margins.right+n.x,l+n.y,"down",h,t),H(f+a-i.Margins.left+n.x,l+n.y,"down",h,t),H(f+n.x,l+i.Margins.top+n.y,"right",h,t),H(f+a+n.x,l+i.Margins.top+n.y,"left",h,t),H(f+n.x,l+u-i.Margins.bottom+n.y,"right",h,t),H(f+a+n.x,l+u-i.Margins.bottom+n.y,"left",h,t),i.PageLines.forEach(m=>{H(f+n.x-25,l+m.LineBounds.y+n.y+12.5,"right",d,t),t.strokeStyle=d,t.beginPath(),t.setLineDash([10,10]),t.moveTo(f+n.x,l+m.LineBounds.y+12.5+n.y),t.lineTo(f+a+n.x,l+m.LineBounds.y+12.5+n.y),t.stroke()}),t.strokeRect(i.MarginAdj[0].Bounds.x+n.x,i.MarginAdj[0].Bounds.y+n.y,i.MarginAdj[0].Bounds.width,i.MarginAdj[0].Bounds.height),t.stroke()}t.restore()}function H(i,e,t,n,s){switch(s.fillStyle=n,s.beginPath(),t){case"down":s.moveTo(i,e-8),s.lineTo(i-9,e-8-9*1.7),s.lineTo(i+9,e-8-9*1.7);break;case"right":s.moveTo(i-8,e),s.lineTo(i-8-9*1.7,e-9),s.lineTo(i-8-9*1.7,e+9);break;case"left":s.moveTo(i+8,e),s.lineTo(i+8+9*1.7,e-9),s.lineTo(i+8+9*1.7,e+9);break;case"up":s.moveTo(i,e+8),s.lineTo(i-9,e+8+9*1.7),s.lineTo(i+9,e+8+9*1.7);break;default:}s.fill()}var We=(i,e,t,n,s,o,r,a,u,f,l,h)=>{var d,m;e.fillStyle="grey",e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),(d=l.PageSettings)!=null&&d.RenderBackground&&e.fillRect(0,0,i.width,i.height),e.restore(),(m=l.PageSettings)!=null&&m.RenderPage&&n.forEach(c=>{Ze(c,i,e,r,f,l)}),e.fillStyle="black",t.forEach((c,g)=>{let S={canvas:i,context:e,camera:r},B=g===t.length-1;Ke(c,S,s.MeasureID,o,B,a,g,u,h)})},Ye=(i,e,t,n,s,o)=>{let r={canvas:i,context:e,camera:s}};var Ft=5,Ot=24,kt=5,_e=(Ot-Ft)*kt,qe=()=>({Position:{x:0,y:5},Staff:0});var Je=(i,e,t,n,s)=>{let o=e.Staff===0?_e*2:_e,r={Instrument:e,Bounds:new D(e.Position.x,t.PageLines[0].LineBounds.y,150,o),TimeSignature:{top:4,bottom:4},KeySignature:"CMaj/Amin",Notes:[],Clef:"treble",RenderClef:!0,RenderTimeSig:!0,RenderKey:!1,Camera:n,Page:t,Message:s};return new p(r,i)},ee=(i,e,t,n,s,o,r,a,u=!1,f)=>{let l={Instrument:i,Bounds:e,TimeSignature:t,KeySignature:n,Notes:[],Clef:s,RenderClef:!1,RenderTimeSig:!1,RenderKey:!1,Camera:o,Page:a,Message:f};return new p(l,r)};var te=class{constructor(e,t){this.x=e,this.y=t,this.oldX=e,this.oldY=t,this.Zoom=1}};var ne=class{constructor(){this.Measures=[],this.Clefs=[],this.Notes=new Map,this.Elements=new Map}TrySelectElement(e,t,n,s,o,r,a){let u,f=[],l=this.Elements.get(e)?this.Elements.get(e):[];return f.push(...e.Notes),f.push(...e.Clefs),f.push(...e.GrandClefs),f.push(e.TimeSignature),f.forEach(h=>{if(h.IsHovered(t,n,s)&&h.Selected===!1){if(h.Selected=!0,l.push(h),h.SelType===1){let d=h,m={messageData:{MessageType:1,Message:{msg:"selected",obj:d}},messageString:"Selected Note"};if(r(m),d.Tied){let c=ie(d,e);l.push(...c)}}u=h,this.Elements.set(e,l)}}),u}DeselectAllElements(e){for(let[t,n]of e)n.forEach(s=>{s.Selected=!1}),e.delete(t);return new Map}SelectElement(){return void 0}DeselectAll(){for(let[e,t]of this.Notes)t.forEach(n=>{n.Selected=!1}),this.Notes.delete(e);for(let[e,t]of this.Elements)t.forEach(n=>{n.Selected=!1}),this.Elements.delete(e)}DeselectNote(e){let t=-1;for(let[n,s]of this.Notes)s.forEach((o,r)=>{o===o&&(t=r)}),t>=0&&this.RemoveDeselected([t],n)}RemoveDeselected(e,t){e.sort();for(let n=e.length-1;n>=0;n--)this.Notes.get(t).splice(n,1);this.Notes.get(t).length===0&&this.Notes.delete(t)}SelectById(e,t){let n;return this.DeselectAll(),e.forEach(s=>{s.Notes.forEach(o=>{if(o.ID===t){o.Selected=!0,n=o;let r=[];r.push(o),o.Tied&&r.push(...ie(o,s)),this.Elements.set(s,r)}})}),n}SelectMeasure(e){if(this.Measures.find(t=>t.ID===e.ID)){let t=this.Measures.indexOf(e);e.Selected=!1,this.Measures.splice(t,1)}else this.Measures.push(e),e.Selected=!0}SelectClef(e){if(this.Clefs.find(t=>t.ID===e.ID)){let t=this.Clefs.indexOf(e);e.Selected=!1,this.Clefs.splice(t,1)}else this.Clefs.map(t=>t.Selected=!1),this.Clefs=[],this.Clefs.push(e),e.Selected=!0}SelectNote(e,t,n,s,o){let r=!1;return e.Divisions.forEach(a=>{e.Notes.filter(f=>f.Beat===a.Beat).forEach(f=>{if(f.Bounds.IsHovered(t,n,s)){if(f.Selected=!0,this.Notes.has(e)){let h=this.Notes.get(e);h.find(d=>d===f)||(h.push(f),f.Tied&&h.push(...ie(f,e)),this.Notes.set(e,h))}else{let h=[];h.push(f),f.Tied&&h.push(...ie(f,e)),this.Notes.set(e,h)}r=!0}else if(f.Selected&&!o){let h=!0;f.Tied&&(h=e.Notes.filter(m=>m!==f&&m.Beat>=f.TiedStart&&m.Beat<=f.TiedEnd&&m.Line===f.Line&&m.Staff===f.Staff&&m.Selected===!0).length===0),h&&(this.DeselectNote(f),f.Selected=!1)}})}),!r&&!o?(this.DeselectAll(),!1):!0}};function ie(i,e){let t=[],n=i.TiedStart,s=i.TiedEnd;return e.Notes.filter(r=>r!==i&&r.Beat>=n&&r.Beat<=s&&r.Staff===i.Staff&&r.Line===i.Line).forEach(r=>{r.Selected=!0,t.push(r)}),t}function Qe(i,e,t){switch(e){case t.addmeasure:i.AddMeasure();break;case t.changeinputmode:i.ChangeInputMode();break;case t.value1:i.SetNoteValue(.03125);break;case t.value2:i.SetNoteValue(.0625);break;case t.value3:i.SetNoteValue(.125);break;case t.value4:i.SetNoteValue(.25);break;case t.value5:i.SetNoteValue(.5);break;case t.value6:i.SetNoteValue(1);break;case t.restInput:i.RestInput=!i.RestInput;break;case t.delete:i.Delete();break;case t.sharpen:i.Sharpen();break;case t.flatten:i.Flatten();break;case t.scaleToggle:break;case t.save:i.Save();break;case t.load:i.LoadSheet("");case t.test_triplet:i.CreateTriplet();default:}}var $t={left:0,right:0,top:10,bottom:10},Ve=6,zt=210*Ve,Ut=297*Ve,se=class{constructor(e,t,n){this.Margins=$t,this.MarginAdj=[],this.Number=n,this.Bounds=new D(e,t,zt,Ut),this.MarginAdj.push({Name:"left",Direction:"horizontal",Bounds:new D(this.Bounds.x+this.Margins.left-12.5,this.Bounds.y-25,25,25)}),this.PageLines=[],this.PageLines.push({Number:1,YPos:t+this.Margins.top,LineBounds:new D(this.Bounds.x-50,t+this.Margins.top-12.5,25,25)})}AddLine(){let e=this.PageLines[this.PageLines.length-1],t={Number:e.Number+1,YPos:this.Bounds.y+this.Margins.top,LineBounds:new D(this.Bounds.x-50,e.LineBounds.y+300-12.5,25,25)};return this.PageLines.push(t),t}};function tt(i,e){let t=e;if(!t){console.error("No page found!");return}let n=0,s=0,o=1,r=0,a=t.Bounds.width-(t.Margins.left+t.Margins.right);i.forEach((u,f)=>{r++;let l=u.GetMinimumWidth()+u.XOffset;(n+l>a||r>4)&&(o++,r=1,e.PageLines.length<o&&e.AddLine(),n=0),n+=l,u.Page=e[s],u.PageLine=o})}function et(i,e,t){var s,o;let n=0;return(o=(s=e.FormatSettings)==null?void 0:s.MeasureFormatSettings)!=null&&o.MaxWidth?n=e.FormatSettings.MeasureFormatSettings.MaxWidth:n=i.Bounds.width*t.Zoom-50,n}function it(i,e,t,n){let s=e.Bounds.width-(e.Margins.left+e.Margins.right);console.log("pageSize: ",s),e.PageLines.forEach(o=>{let r=i.filter(f=>f.PageLine===o.Number),a=0;r.forEach((f,l)=>{a+=f.GetMinimumWidth()+f.XOffset});let u=s-a;r.forEach((f,l)=>{if(f.Bounds.y=o.LineBounds.y,f.PrefBoundsY=f.Bounds.y,l===0){f.Bounds.x=e.Bounds.x+e.Margins.left,f.RenderClef=!0,f.RenderTimeSig=!0,f.RenderKey=!1,f.SetXOffset();let h=et(e,n,t),d=f.GetMinimumWidth()+u/r.length,m=h&&d>h?h:d;f.Bounds.width=m,f.CreateDivisions(t)}else{f.RenderClef=!1,f.RenderTimeSig=!1,f.RenderKey=!1,f.SetXOffset();let h=et(e,n,t),d=f.GetMinimumWidth()+u/r.length,m=h&&d>h?h:d;f.Bounds.width=m,r[l].Reposition(r[l-1]),f.CreateDivisions(t)}f.Clefs.forEach(h=>{h.SetBounds(f,0)}),f.GrandClefs.forEach(h=>{h.SetBounds(f,1)}),f.TimeSignature.SetBounds(f,0),f.Instrument.Staff===1&&f.TimeSignature.SetBounds(f,1)})})}var nt=(i,e,t,n,s,o)=>{let r={count:0};JSON.parse(s).Measures.forEach((u,f)=>{let l=[];u.Notes.forEach((d,m)=>{let c={Beat:d.Beat,Duration:d.Duration,Line:d.Line,Rest:d.Rest,Tied:d.Tied,Staff:d.Staff,Tuple:!1,Clef:d.Clef,Editable:!1},g=new C(c);l.push(g)});let h=ee(n,u.Bounds,u.TimeSignature,"CMaj/Amin","treble",t,r,e,u.ShowClef,o);h.Notes=l,i.Measures.push(h),h.CreateDivisions(t)})},st=i=>{let e={Measures:[]};return i.Measures.forEach((t,n)=>{let s=[];t.Notes.forEach((o,r)=>{o.Rest||s.push({ID:o.ID,Beat:o.Beat,Duration:o.Duration,Line:o.Line,Rest:o.Rest,Tied:o.Tied,Staff:o.Staff,Clef:o.Clef,Editable:!1})}),e.Measures.push({Clef:"treble",TimeSignature:t.TimeSignature,Notes:s,Bounds:t.Bounds,ShowClef:t.RenderClef,ShowTime:t.RenderTimeSig})}),console.log(JSON.stringify(e)),JSON.stringify(e)};var Xt='{"Measures":[{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":2,"Beat":1,"Duration":0.5,"Line":12,"Rest":false,"Tied":false,"Staff":0},{"ID":5,"Beat":1,"Duration":0.5,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":66,"Beat":1,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":70,"Beat":1.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":71,"Beat":2,"Duration":0.125,"Line":1037,"Rest":false,"Tied":false,"Staff":1},{"ID":73,"Beat":2.5,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1},{"ID":6,"Beat":3,"Duration":0.25,"Line":13,"Rest":false,"Tied":false,"Staff":0},{"ID":8,"Beat":3,"Duration":0.25,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":9,"Beat":3,"Duration":0.25,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":74,"Beat":3,"Duration":0.125,"Line":1047,"Rest":false,"Tied":false,"Staff":1},{"ID":77,"Beat":3.5,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1},{"ID":10,"Beat":4,"Duration":0.25,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":78,"Beat":4,"Duration":0.125,"Line":1038,"Rest":false,"Tied":false,"Staff":1},{"ID":80,"Beat":4.5,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":100,"y":87.5,"width":263.3333333333333,"height":190},"ShowClef":true,"ShowTime":true},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":17,"Beat":1,"Duration":0.25,"Line":19,"Rest":false,"Tied":false,"Staff":0},{"ID":20,"Beat":1,"Duration":0.25,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":21,"Beat":1,"Duration":0.25,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":81,"Beat":1,"Duration":0.125,"Line":1048,"Rest":false,"Tied":false,"Staff":1},{"ID":84,"Beat":1.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":22,"Beat":2,"Duration":0.25,"Line":12,"Rest":false,"Tied":false,"Staff":0},{"ID":85,"Beat":2,"Duration":0.125,"Line":1039,"Rest":false,"Tied":false,"Staff":1},{"ID":87,"Beat":2.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":23,"Beat":3,"Duration":0.25,"Line":10,"Rest":false,"Tied":false,"Staff":0},{"ID":25,"Beat":3,"Duration":0.25,"Line":13,"Rest":false,"Tied":false,"Staff":0},{"ID":26,"Beat":3,"Duration":0.25,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":88,"Beat":3,"Duration":0.125,"Line":1049,"Rest":false,"Tied":false,"Staff":1},{"ID":91,"Beat":3.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":27,"Beat":4,"Duration":0.25,"Line":9,"Rest":false,"Tied":false,"Staff":0},{"ID":92,"Beat":4,"Duration":0.125,"Line":1040,"Rest":false,"Tied":false,"Staff":1},{"ID":94,"Beat":4.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":423.3333333333333,"y":87.5,"width":263.3333333333333,"height":190},"ShowClef":false,"ShowTime":false},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":30,"Beat":1,"Duration":0.25,"Line":11,"Rest":false,"Tied":false,"Staff":0},{"ID":33,"Beat":1,"Duration":0.25,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":34,"Beat":1,"Duration":0.25,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":95,"Beat":1,"Duration":0.125,"Line":1050,"Rest":false,"Tied":false,"Staff":1},{"ID":99,"Beat":1.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":35,"Beat":2,"Duration":0.25,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":100,"Beat":2,"Duration":0.125,"Line":1041,"Rest":false,"Tied":false,"Staff":1},{"ID":102,"Beat":2.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":36,"Beat":3,"Duration":0.5,"Line":12,"Rest":false,"Tied":false,"Staff":0},{"ID":37,"Beat":3,"Duration":0.5,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":38,"Beat":3,"Duration":0.5,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":103,"Beat":3,"Duration":0.125,"Line":1051,"Rest":false,"Tied":false,"Staff":1},{"ID":106,"Beat":3.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":107,"Beat":4,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1},{"ID":109,"Beat":4.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":686.6666666666666,"y":87.5,"width":263.3333333333333,"height":190},"ShowClef":false,"ShowTime":false},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":41,"Beat":1,"Duration":0.25,"Line":21,"Rest":false,"Tied":false,"Staff":0},{"ID":44,"Beat":1,"Duration":0.25,"Line":18,"Rest":false,"Tied":false,"Staff":0},{"ID":45,"Beat":1,"Duration":0.25,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":110,"Beat":1,"Duration":0.125,"Line":1050,"Rest":false,"Tied":false,"Staff":1},{"ID":114,"Beat":1.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":46,"Beat":2,"Duration":0.25,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":115,"Beat":2,"Duration":0.125,"Line":1041,"Rest":false,"Tied":false,"Staff":1},{"ID":117,"Beat":2.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":52,"Beat":3,"Duration":0.25,"Line":20,"Rest":false,"Tied":false,"Staff":0},{"ID":53,"Beat":3,"Duration":0.25,"Line":19,"Rest":false,"Tied":false,"Staff":0},{"ID":118,"Beat":3,"Duration":0.125,"Line":1049,"Rest":false,"Tied":false,"Staff":1},{"ID":121,"Beat":3.5,"Duration":0.125,"Line":1045,"Rest":false,"Tied":false,"Staff":1},{"ID":55,"Beat":4,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":122,"Beat":4,"Duration":0.125,"Line":1040,"Rest":false,"Tied":false,"Staff":1},{"ID":57,"Beat":4.5,"Duration":0.125,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":124,"Beat":4.5,"Duration":0.125,"Line":1045,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":100,"y":375,"width":263.3333333333333,"height":190},"ShowClef":true,"ShowTime":true},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":125,"Beat":1,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":173,"Beat":1,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":129,"Beat":1.5,"Duration":0.125,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":177,"Beat":1.5,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1},{"ID":130,"Beat":2,"Duration":0.25,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":178,"Beat":2,"Duration":0.125,"Line":1037,"Rest":false,"Tied":false,"Staff":1},{"ID":180,"Beat":2.5,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1},{"ID":131,"Beat":3,"Duration":0.25,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":181,"Beat":3,"Duration":0.125,"Line":1047,"Rest":false,"Tied":false,"Staff":1},{"ID":184,"Beat":3.5,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1},{"ID":133,"Beat":4,"Duration":0.25,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":185,"Beat":4,"Duration":0.125,"Line":1038,"Rest":false,"Tied":false,"Staff":1},{"ID":187,"Beat":4.5,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":423.3333333333333,"y":375,"width":263.3333333333333,"height":190},"ShowClef":false,"ShowTime":false},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":134,"Beat":1,"Duration":0.25,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":188,"Beat":1,"Duration":0.125,"Line":1048,"Rest":false,"Tied":false,"Staff":1},{"ID":192,"Beat":1.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":137,"Beat":2,"Duration":0.25,"Line":12,"Rest":false,"Tied":false,"Staff":0},{"ID":193,"Beat":2,"Duration":0.125,"Line":1039,"Rest":false,"Tied":false,"Staff":1},{"ID":195,"Beat":2.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":138,"Beat":3,"Duration":0.125,"Line":10,"Rest":false,"Tied":false,"Staff":0},{"ID":196,"Beat":3,"Duration":0.125,"Line":1049,"Rest":false,"Tied":false,"Staff":1},{"ID":141,"Beat":3.5,"Duration":0.125,"Line":12,"Rest":false,"Tied":false,"Staff":0},{"ID":199,"Beat":3.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":142,"Beat":4,"Duration":0.125,"Line":10,"Rest":false,"Tied":false,"Staff":0},{"ID":200,"Beat":4,"Duration":0.125,"Line":1040,"Rest":false,"Tied":false,"Staff":1},{"ID":144,"Beat":4.5,"Duration":0.125,"Line":9,"Rest":false,"Tied":false,"Staff":0},{"ID":202,"Beat":4.5,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":686.6666666666666,"y":375,"width":263.3333333333333,"height":190},"ShowClef":false,"ShowTime":false},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":145,"Beat":1,"Duration":0.125,"Line":11,"Rest":false,"Tied":false,"Staff":0},{"ID":203,"Beat":1,"Duration":0.125,"Line":1050,"Rest":false,"Tied":false,"Staff":1},{"ID":149,"Beat":1.5,"Duration":0.125,"Line":12,"Rest":false,"Tied":false,"Staff":0},{"ID":207,"Beat":1.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":150,"Beat":2,"Duration":0.125,"Line":13,"Rest":false,"Tied":false,"Staff":0},{"ID":208,"Beat":2,"Duration":0.125,"Line":1041,"Rest":false,"Tied":false,"Staff":1},{"ID":152,"Beat":2.5,"Duration":0.125,"Line":11,"Rest":false,"Tied":false,"Staff":0},{"ID":210,"Beat":2.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":153,"Beat":3,"Duration":0.125,"Line":12,"Rest":false,"Tied":false,"Staff":0},{"ID":211,"Beat":3,"Duration":0.125,"Line":1051,"Rest":false,"Tied":false,"Staff":1},{"ID":156,"Beat":3.5,"Duration":0.125,"Line":13,"Rest":false,"Tied":false,"Staff":0},{"ID":214,"Beat":3.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":157,"Beat":4,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":215,"Beat":4,"Duration":0.125,"Line":1042,"Rest":false,"Tied":false,"Staff":1},{"ID":159,"Beat":4.5,"Duration":0.125,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":217,"Beat":4.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":100,"y":662.5,"width":395,"height":190},"ShowClef":true,"ShowTime":true},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":160,"Beat":1,"Duration":0.125,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":218,"Beat":1,"Duration":0.125,"Line":1050,"Rest":false,"Tied":false,"Staff":1},{"ID":164,"Beat":1.5,"Duration":0.125,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":222,"Beat":1.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":165,"Beat":2,"Duration":0.125,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":223,"Beat":2,"Duration":0.125,"Line":1041,"Rest":false,"Tied":false,"Staff":1},{"ID":167,"Beat":2.5,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":225,"Beat":2.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":168,"Beat":3,"Duration":0.25,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":226,"Beat":3,"Duration":0.125,"Line":1049,"Rest":false,"Tied":false,"Staff":1},{"ID":229,"Beat":3.5,"Duration":0.125,"Line":1045,"Rest":false,"Tied":false,"Staff":1},{"ID":170,"Beat":4,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":230,"Beat":4,"Duration":0.125,"Line":1040,"Rest":false,"Tied":false,"Staff":1},{"ID":172,"Beat":4.5,"Duration":0.125,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":232,"Beat":4.5,"Duration":0.125,"Line":1045,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":555,"y":662.5,"width":395,"height":190},"ShowClef":false,"ShowTime":false}]}',jt='{"Measures":[{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":2,"Beat":1,"Duration":0.03125,"Line":18,"Rest":false,"Tied":false,"Staff":0},{"ID":54,"Beat":1,"Duration":0.125,"Line":1047,"Rest":false,"Tied":false,"Staff":1},{"ID":8,"Beat":1.125,"Duration":0.03125,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":9,"Beat":1.5,"Duration":0.03125,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":12,"Beat":1.625,"Duration":0.03125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":13,"Beat":2,"Duration":0.125,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":58,"Beat":2,"Duration":0.125,"Line":1045,"Rest":false,"Tied":false,"Staff":1},{"ID":15,"Beat":2.5,"Duration":0.125,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":16,"Beat":3,"Duration":0.125,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":60,"Beat":3,"Duration":0.125,"Line":1047,"Rest":false,"Tied":false,"Staff":1},{"ID":19,"Beat":3.5,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0}],"Bounds":{"x":100,"y":87.5,"width":383.3333333333333,"height":190},"ShowClef":true,"ShowTime":true},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":22,"Beat":1,"Duration":0.0625,"Line":18,"Rest":false,"Tied":false,"Staff":0},{"ID":63,"Beat":1,"Duration":0.125,"Line":1045,"Rest":false,"Tied":false,"Staff":1},{"ID":27,"Beat":1.25,"Duration":0.0625,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":28,"Beat":1.5,"Duration":0.0625,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":30,"Beat":1.75,"Duration":0.0625,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":67,"Beat":2,"Duration":0.125,"Line":1048,"Rest":false,"Tied":false,"Staff":1},{"ID":69,"Beat":2.5,"Duration":0.125,"Line":1045,"Rest":false,"Tied":false,"Staff":1}],"Bounds":{"x":543.3333333333333,"y":87.5,"width":233.33333333333334,"height":190},"ShowClef":false,"ShowTime":false},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":33,"Beat":1,"Duration":0.25,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":70,"Beat":1,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":74,"Beat":1.5,"Duration":0.125,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":36,"Beat":2,"Duration":0.25,"Line":15,"Rest":false,"Tied":false,"Staff":0},{"ID":37,"Beat":3,"Duration":0.25,"Line":16,"Rest":false,"Tied":false,"Staff":0}],"Bounds":{"x":776.6666666666666,"y":87.5,"width":173.33333333333334,"height":190},"ShowClef":false,"ShowTime":false},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":41,"Beat":1,"Duration":0.25,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":75,"Beat":1,"Duration":0.125,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":44,"Beat":2,"Duration":0.125,"Line":16,"Rest":false,"Tied":false,"Staff":0},{"ID":89,"Beat":2,"Duration":0.25,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":46,"Beat":2.5,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":47,"Beat":3,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":91,"Beat":3,"Duration":0.25,"Line":1043,"Rest":false,"Tied":false,"Staff":1},{"ID":50,"Beat":3.5,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0},{"ID":51,"Beat":4,"Duration":0.125,"Line":17,"Rest":false,"Tied":false,"Staff":0},{"ID":92,"Beat":4,"Duration":0.25,"Line":1044,"Rest":false,"Tied":false,"Staff":1},{"ID":53,"Beat":4.5,"Duration":0.125,"Line":14,"Rest":false,"Tied":false,"Staff":0}],"Bounds":{"x":100,"y":375,"width":485,"height":190},"ShowClef":true,"ShowTime":true},{"Clef":"treble","TimeSignature":{"top":4,"bottom":4},"Notes":[{"ID":85,"Beat":1,"Duration":1,"Line":1046,"Rest":false,"Tied":false,"Staff":1},{"ID":86,"Beat":1,"Duration":1,"Line":14,"Rest":false,"Tied":false,"Staff":0}],"Bounds":{"x":645,"y":375,"width":305,"height":190},"ShowClef":false,"ShowTime":false}]}';var ot=[{name:"Canon in C",file:Xt},{name:"Random FIle One",file:jt}];var oe=class{constructor(e,t,n,s,o,r=!1){if(this.Config=o,this.PitchMap=Ne(),this.Message=Te(),this.NotifyCallback=s,this.Debug=!0,this.Canvas=e,this.Container=t,this.Selector=new ne,this.Context=n,this.Load=r,this.HoveredElements={MeasureID:-1},this.Zoom=1,this.RunningID={count:0},this.CamDragging=!1,this.DraggingPositions={x1:0,y1:0,x2:0,y2:0},this.Camera=new te(0,20),this.Camera.Zoom=1,this.NoteValue=.5,this.StartDragY=0,this.EndDragY=0,this.DragLining=!1,!this.Load){let a={Instruments:[],KeySignature:[{key:"CMaj",measureNo:0}],Measures:[],Pages:[new se(0,0,1)]},u=a.Pages[0];a.Instruments.push(qe()),a.Measures.push(Je(this.RunningID,a.Instruments[0],u,this.Camera,this.NotifyCallback)),this.Sheet=new Y(a)}this.NoteInput=!1,this.RestInput=!1,this.Formatting=!1,this.Update(0,0)}Hover(e,t){if(e=e/this.Camera.Zoom,t=t/this.Camera.Zoom,this.CamDragging){this.Camera.x=Math.floor(this.Camera.oldX+e-this.DraggingPositions.x1),this.Camera.y=Math.floor(this.Camera.oldY+t-this.DraggingPositions.y1),this.Update(e,t);return}this.DraggingNote&&(this.DragNote(e,t),this.Update(e,t)),this.Formatting&&this.DragLining&&(this.DragLiner(e,t),this.Update(e,t)),this.HoveredElements.MeasureID=-1,this.NoteInput&&this.Sheet.Measures.forEach(n=>{n.GetBoundsWithOffset().IsHovered(e,t,this.Camera)?n.Divisions.forEach(s=>{s.Bounds.IsHovered(e,t,this.Camera)&&(G(n,0),G(n,1))}):n.ResetHeight()}),this.Update(e,t)}Delete(){for(let[e,t]of this.Selector.Elements)e.DeleteSelected(),e.CreateDivisions(this.Camera)}Input(e,t,n){e=e/this.Camera.Zoom,t=t/this.Camera.Zoom,!this.NoteInput&&this.Formatting&&this.SelectLiner(e,t),this.HoveredElements.MeasureID=-1;let s=this.Sheet.Measures.find(o=>o.GetBoundsWithOffset().IsHovered(e,t,this.Camera));if(s===void 0){n||(this.Selector.DeselectAll(),this.Update(e,t));return}if(this.NoteInput)this.NoteInput&&(ve(s,this.NoteValue,e,t,this.Camera,this.RestInput),this.ResizeMeasures(this.Sheet.Measures.filter(o=>o.Instrument===s.Instrument)));else{let o=!1;console.log(this.Selector.Elements),n||(this.Selector.Elements=this.Selector.DeselectAllElements(this.Selector.Elements)),(this.Selector.TrySelectElement(s,e,t,this.Camera,n,this.NotifyCallback,this.Selector.Elements)===void 0&&this.Config.FormatSettings.MeasureFormatSettings.Selectable===!0||this.Config.FormatSettings.MeasureFormatSettings.Selectable===void 0)&&this.Selector.SelectMeasure(s),this.DraggingNote||(this.DraggingNote=!0),this.StartLine=p.GetLineHovered(t,s).num}this.Update(e,t)}Update(e,t){this.Render({x:e,y:t})}Render(e){We(this.Canvas,this.Context,this.Sheet.Measures,this.Sheet.Pages,this.HoveredElements,e,this.Camera,this.NoteInput,this.RestInput,this.Formatting,this.Config,this.NoteValue),this.Debug&&Ye(this.Canvas,this.Context,this.Sheet,e,this.Camera,this.Selector)}AddMeasure(){let e=this.Sheet.Measures.length,t=this.Sheet.Measures[this.Sheet.Measures.length-1],n=0;this.Sheet.Instruments.forEach(s=>{let o=this.Sheet.Pages[0].PageLines[this.Sheet.Pages[0].PageLines.length-1],r=new D(n,o.LineBounds.y,150,t.Bounds.height),a=ee(s,r,t.TimeSignature,t.KeySignature,"treble",this.Camera,this.RunningID,this.Sheet.Pages[0],!1,this.NotifyCallback);this.Sheet.Measures.push(a),this.ResizeMeasures(this.Sheet.Measures.filter(u=>u.Instrument===s))})}ChangeInputMode(){this.NoteInput=!this.NoteInput}SelectLiner(e,t){let n;return this.DragLining||(this.LineNumber=-1),this.Sheet.Pages.forEach(s=>{s.PageLines.forEach(o=>{o.LineBounds.IsHovered(e,t,this.Camera)&&(n=o.LineBounds,this.DragLining||(this.StartDragY=t,this.DragLining=!0,this.LinerBounds=n,this.LineNumber=o.Number))})}),n}DragLiner(e,t){if(this.LinerBounds){this.LinerBounds.y=this.LinerBounds.y+(t-this.StartDragY);let n=this.Sheet.Pages[0];this.LinerBounds.y+12.5<=n.Bounds.y+n.Margins.top&&(this.LinerBounds.y=n.Bounds.y+n.Margins.top-12.5),this.StartDragY=t,this.Sheet.Measures.forEach(s=>{s.PageLine===this.LineNumber&&(s.Bounds.y=this.LinerBounds.y,s.PrefBoundsY=s.Bounds.y)}),this.ResizeMeasures(this.Sheet.Measures)}}DragNote(e,t){let n=this.Sheet.Measures.find(o=>o.GetBoundsWithOffset().IsHovered(e,t,this.Camera));if(n===void 0){this.DraggingNote=!1,this.StartLine=-1,this.EndLine=-1;return}this.EndLine=p.GetLineHovered(t,n).num;let s=this.EndLine-this.StartLine;for(let[o,r]of this.Selector.Elements)r.filter(a=>a.SelType===1).forEach(a=>{a.Selected&&a.Editable&&(a.Line+=s,G(o,a.Staff))});this.StartLine=this.EndLine}StopNoteDrag(e,t){this.DraggingNote&&(this.StartLine=-1,this.EndLine=-1,this.DraggingNote=!1),this.DragLining&&(this.DragLining=!1)}SetCameraDragging(e,t,n){var s;if(((s=this.Config.CameraSettings)==null?void 0:s.DragEnabled)===!1){this.CamDragging=!1;return}this.CamDragging=e,this.CamDragging?(this.DraggingPositions.x1=t/this.Camera.Zoom,this.DraggingPositions.y1=n/this.Camera.Zoom):(this.DraggingPositions.x1=0,this.DraggingPositions.y1=0,this.DraggingPositions.x2=0,this.DraggingPositions.y2=0,this.Camera.oldX=this.Camera.x,this.Camera.oldY=this.Camera.y)}AlterZoom(e){this.Zoom+=e,this.Camera.Zoom=this.Zoom,this.Context.setTransform(this.Camera.Zoom,0,0,this.Camera.Zoom,0,0),this.Update(0,0)}ResizeFirstMeasure(){this.Sheet.Measures[0].CreateDivisions(this.Camera);for(let e=1;e<this.Sheet.Measures.length;e++)this.Sheet.Measures[e].Reposition(this.Sheet.Measures[e-1]);this.Update(0,0)}ResizeMeasures(e){tt(e,this.Sheet.Pages[0]),it(e,this.Sheet.Pages[0],this.Camera,this.Config),this.CenterMeasures(),this.Update(0,0)}SetNoteValue(e){this.NoteValue=e}Sharpen(){for(let[e,t]of this.Selector.Elements)t.forEach(n=>{if(n.SelType===1){let s=n;s.Accidental+=1,s.Accidental>2&&(s.Accidental=2)}});this.Update(0,0)}Flatten(){for(let[e,t]of this.Selector.Elements)t.forEach(n=>{if(n.SelType===1){let s=n;s.Accidental-=1,s.Accidental<-2&&(s.Accidental=-2)}});this.Update(0,0)}ScaleToggle(){return this.Camera.Zoom!==1?(this.Camera.Zoom=1,this.Zoom=1):this.Camera.Zoom=1,this.Camera.Zoom}KeyInput(e,t){Qe(this,e,t),this.NotifyCallback(this.Message)}SelectById(e){let t=this.Selector.SelectById(this.Sheet.Measures,e);return this.Update(0,0),t}ToggleFormatting(){this.Formatting=!this.Formatting,this.Formatting&&(this.NoteInput=!1,this.RestInput=!1)}Save(){st(this.Sheet)}LoadSheet(e){this.Sheet.Measures=[],nt(this.Sheet,this.Sheet.Pages[0],this.Camera,this.Sheet.Instruments[0],e,this.NotifyCallback),this.ResizeMeasures(this.Sheet.Measures),this.Update(0,0)}GetSaveFiles(){return ot}CreateTriplet(){this.NoteValue=Ee(this.Selector.Notes,4),this.ResizeMeasures(this.Sheet.Measures),this.Update(0,0)}ChangeTimeSignature(e,t,n=!1){for(let[s,o]of this.Selector.Elements)s.ChangeTimeSignature(e,t,n)}CenterMeasures(){var n,s;let e=100;(s=(n=this.Config.FormatSettings)==null?void 0:n.MeasureFormatSettings)!=null&&s.MaxWidth&&(e=this.Config.FormatSettings.MeasureFormatSettings.MaxWidth);let t=(this.Canvas.clientWidth-(e+e/2)*this.Camera.Zoom)/4;this.Camera.x=t}AddNoteOnMeasure(e,t,n,s,o){ye(e,t,n,s,o)}};var P;var Kt={CameraSettings:{DragEnabled:!1,ZoomEnabled:!1,Zoom:1,StartingPosition:{x:0,y:0},CenterMeasures:!0},FormatSettings:{MeasureFormatSettings:{MaxWidth:100,Selectable:!1}},NoteSettings:{InputValue:.5},PageSettings:{RenderPage:!1,RenderBackground:!1,ContainerWidth:!1}};function Zt(i,e,t){let n=e.getBoundingClientRect(),s=t.clientX-n.left,o=t.clientY-n.top;i.Hover(s,o)}function Wt(i,e,t){t.preventDefault();let n=e.getBoundingClientRect(),s=t.clientX-n.left,o=t.clientY-n.top;t.buttons===1?i.Input(s,o,t.shiftKey):t.buttons===4&&i.SetCameraDragging(!0,s,o)}function Yt(i,e,t){let n=e.getBoundingClientRect(),s=t.clientX-n.left,o=t.clientY-n.top;i.SetCameraDragging(!1,0,0),i.StopNoteDrag(s,o)}function _t(i,e,t){let n=t.key;i.KeyInput(n,e)}function qt(i,e){e.ctrlKey&&(e.preventDefault(),e.deltaY*-.01>0?i.AlterZoom(.05):i.AlterZoom(-.05))}function Jt(i,e,t,n){var s;t.width=n.clientWidth-50,((s=i.Config.CameraSettings)==null?void 0:s.CenterMeasures)===!0&&i.CenterMeasures(),i.AlterZoom(0),i.Update(0,0)}var at;(d=>{function i(m,c,g,S,B,b){let T=m.getContext("2d"),L=new oe(m,c,T,B,b);return m.addEventListener("mousemove",M=>Zt(L,m,M)),m.addEventListener("mousedown",M=>Wt(L,m,M)),m.addEventListener("mouseup",M=>Yt(L,m,M)),g.addEventListener("keydown",M=>_t(L,S,M)),window.addEventListener("resize",()=>Jt(L,L.Context,m,c)),m.addEventListener("wheel",M=>qt(L,M)),P=L,m.width=c.clientWidth,m.height=c.clientHeight,L.Update(0,0),L.AlterZoom(Kt.CameraSettings.Zoom),L.CenterMeasures(),L}d.CreateApp=i;function e(){P.ChangeInputMode()}d.ChangeInputMode=e;function t(){P.Sharpen()}d.Sharpen=t;function n(){P.Flatten()}d.Flatten=n;function s(m){P.SetNoteValue(m)}d.SetNoteValue=s;function o(){P.AddMeasure()}d.AddMeasure=o;function r(m,c,g,S,B){P.AddNoteOnMeasure(m,c,g,S,B)}d.AddNoteOnMeasure=r;function a(){P.Delete()}d.Delete=a;function u(m){return P.SelectById(m)}d.SelectById=u;function f(){P.ToggleFormatting()}d.ToggleFormatting=f;function l(){P.Delete()}d.DeleteSelected=l;function h(m,c,g=!1){console.log("Changing time sisiigiangiangiang"),P.ChangeTimeSignature(m,c,g)}d.ChangeTimeSignature=h})(at||(at={}));export{oe as App,Te as ClearMessage,Ne as GeneratePitchMap,Qe as KeyPress,nt as LoadSheet,re as MessageType,C as Note,Si as ReturnLineFromMidi,Ce as ReturnMidiNumber,st as SaveSheet,at as sheet};
//# sourceMappingURL=entry.mjs.map